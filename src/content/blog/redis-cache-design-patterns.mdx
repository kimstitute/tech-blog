---
title: "Redisç¼“å­˜è®¾è®¡æ¨¡å¼ä¸æœ€ä½³å®è·µæ·±åº¦è§£æ"
description: "æ·±å…¥æ¢è®¨Redisç¼“å­˜è®¾è®¡æ¨¡å¼ã€ä¸€è‡´æ€§ç­–ç•¥å’Œæ€§èƒ½ä¼˜åŒ–æ–¹æ¡ˆï¼Œç»“åˆå®é™…é¡¹ç›®ç»éªŒåˆ†äº«ç¼“å­˜ç©¿é€ã€å‡»ç©¿ã€é›ªå´©ç­‰é—®é¢˜çš„è§£å†³æ–¹æ¡ˆã€‚"
pubDate: 2024-12-28
updatedDate: 2024-12-28
tags: ["redis", "cache", "design-patterns", "consistency", "performance", "distributed-cache", "interview", "best-practices"]
categories: ["middleware"]
subject: "Redisç¼“å­˜è®¾è®¡"
draft: false
featured: true
author: "Gerrad Zhang"
location: "æ­¦æ±‰ï¼Œä¸­å›½"
---

## ğŸ¤” é—®é¢˜èƒŒæ™¯ä¸æŠ€æœ¯æ¼”è¿›

### æˆ‘ä»¬è¦è§£å†³ä»€ä¹ˆé—®é¢˜ï¼Ÿ

åœ¨é«˜å¹¶å‘ç³»ç»Ÿä¸­ï¼Œæ•°æ®åº“å¾€å¾€æˆä¸ºæ€§èƒ½ç“¶é¢ˆã€‚ä¼ ç»Ÿçš„æ•°æ®åº“æŸ¥è¯¢å“åº”æ—¶é—´åœ¨æ¯«ç§’çº§ï¼Œè€ŒRedisç¼“å­˜å¯ä»¥è¾¾åˆ°å¾®ç§’çº§å“åº”ã€‚ç¼“å­˜æŠ€æœ¯è¦è§£å†³çš„æ ¸å¿ƒé—®é¢˜åŒ…æ‹¬ï¼š**å‡å°‘æ•°æ®åº“å‹åŠ›**ã€**æå‡å“åº”é€Ÿåº¦**ã€**é™ä½ç³»ç»Ÿå»¶è¿Ÿ**ã€**æé«˜å¹¶å‘èƒ½åŠ›**ã€‚

ä½†ç¼“å­˜ä½¿ç”¨ä¸å½“ä¹Ÿä¼šå¸¦æ¥é—®é¢˜ï¼š**æ•°æ®ä¸ä¸€è‡´**ã€**ç¼“å­˜ç©¿é€**ã€**ç¼“å­˜å‡»ç©¿**ã€**ç¼“å­˜é›ªå´©**ç­‰ã€‚éœ€è¦é€šè¿‡åˆç†çš„è®¾è®¡æ¨¡å¼æ¥è§„é¿è¿™äº›é£é™©ã€‚

### æ²¡æœ‰è¿™ä¸ªæŠ€æœ¯æ—¶æ˜¯æ€ä¹ˆåšçš„ï¼Ÿ

æ—©æœŸç³»ç»Ÿä¸»è¦é€šè¿‡ï¼š**æ•°æ®åº“ä¼˜åŒ–**ã€**è¯»å†™åˆ†ç¦»**ã€**åº”ç”¨å±‚ç¼“å­˜**ç­‰æ–¹å¼æå‡æ€§èƒ½ã€‚è¿™äº›æ–¹æ¡ˆå­˜åœ¨æ‰©å±•æ€§å·®ã€ä¸€è‡´æ€§éš¾ä¿è¯ã€å¼€å‘å¤æ‚åº¦é«˜ç­‰é—®é¢˜ã€‚

### æŠ€æœ¯æ¼”è¿›çš„å†å²è„‰ç»œ

ç¼“å­˜æŠ€æœ¯ä»**æœ¬åœ°ç¼“å­˜** â†’ **åˆ†å¸ƒå¼ç¼“å­˜** â†’ **å¤šçº§ç¼“å­˜** â†’ **æ™ºèƒ½ç¼“å­˜**ä¸æ–­æ¼”è¿›ï¼ŒRedisä½œä¸ºä¸»æµåˆ†å¸ƒå¼ç¼“å­˜è§£å†³æ–¹æ¡ˆï¼Œæä¾›äº†ä¸°å¯Œçš„æ•°æ®ç»“æ„å’Œé«˜æ€§èƒ½çš„è¯»å†™èƒ½åŠ›ã€‚

## ğŸ¯ æ ¸å¿ƒæ¦‚å¿µä¸åŸç†

### åŸºç¡€æ¦‚å¿µå®šä¹‰

**ç¼“å­˜æ¨¡å¼**ï¼šå®šä¹‰ç¼“å­˜ä¸æ•°æ®åº“ä¹‹é—´çš„æ•°æ®åŒæ­¥ç­–ç•¥ï¼ŒåŒ…æ‹¬Cache-Asideã€Write-Throughã€Write-Behindç­‰æ¨¡å¼ã€‚

**ä¸€è‡´æ€§ç­–ç•¥**ï¼šä¿è¯ç¼“å­˜ä¸æ•°æ®åº“æ•°æ®ä¸€è‡´æ€§çš„æ–¹æ³•ï¼ŒåŒ…æ‹¬å¼ºä¸€è‡´æ€§ã€å¼±ä¸€è‡´æ€§ã€æœ€ç»ˆä¸€è‡´æ€§ç­‰çº§åˆ«ã€‚

**ç¼“å­˜è®¾è®¡æ¨¡å¼**ï¼šè§£å†³ç‰¹å®šç¼“å­˜é—®é¢˜çš„æ ‡å‡†åŒ–æ–¹æ¡ˆï¼Œå¦‚å¸ƒéš†è¿‡æ»¤å™¨ã€åˆ†å¸ƒå¼é”ã€çƒ­ç‚¹æ•°æ®å¤„ç†ç­‰ã€‚

### å·¥ä½œåŸç†è¯¦è§£

**Cache-Asideæ¨¡å¼**ï¼šåº”ç”¨ç¨‹åºç›´æ¥ç®¡ç†ç¼“å­˜ï¼Œè¯»å–æ—¶å…ˆæŸ¥ç¼“å­˜ï¼Œç¼“å­˜æœªå‘½ä¸­åˆ™æŸ¥æ•°æ®åº“å¹¶æ›´æ–°ç¼“å­˜ã€‚

**Write-Throughæ¨¡å¼**ï¼šå†™æ“ä½œåŒæ—¶æ›´æ–°ç¼“å­˜å’Œæ•°æ®åº“ï¼Œä¿è¯æ•°æ®ä¸€è‡´æ€§ä½†å½±å“å†™æ€§èƒ½ã€‚

**Write-Behindæ¨¡å¼**ï¼šå†™æ“ä½œåªæ›´æ–°ç¼“å­˜ï¼Œå¼‚æ­¥æ›´æ–°æ•°æ®åº“ï¼Œæå‡å†™æ€§èƒ½ä½†å¯èƒ½ä¸¢å¤±æ•°æ®ã€‚

### æŠ€æœ¯ç‰¹ç‚¹å’Œä¼˜åŠ¿

Redisç¼“å­˜å…·æœ‰ï¼š**é«˜æ€§èƒ½**ã€**ä¸°å¯Œæ•°æ®ç»“æ„**ã€**æŒä¹…åŒ–æ”¯æŒ**ã€**é›†ç¾¤æ‰©å±•**ã€**äº‹åŠ¡æ”¯æŒ**ç­‰ç‰¹ç‚¹ï¼Œé€‚åˆæ„å»ºé«˜å¯ç”¨çš„ç¼“å­˜ç³»ç»Ÿã€‚

## ğŸ”§ å®ç°åŸç†ä¸æºç åˆ†æ

### åº•å±‚å®ç°æœºåˆ¶

Redisç¼“å­˜çš„æ ¸å¿ƒæœºåˆ¶åŒ…æ‹¬ï¼š

**å†…å­˜ç®¡ç†**ï¼šä½¿ç”¨jemallocå†…å­˜åˆ†é…å™¨ï¼Œæ”¯æŒå†…å­˜ç¢ç‰‡æ•´ç†
**æ•°æ®ç»“æ„**ï¼šSDSå­—ç¬¦ä¸²ã€ziplistå‹ç¼©åˆ—è¡¨ã€skiplistè·³è·ƒè¡¨ç­‰é«˜æ•ˆç»“æ„
**è¿‡æœŸç­–ç•¥**ï¼šæƒ°æ€§åˆ é™¤+å®šæœŸåˆ é™¤çš„ç»„åˆç­–ç•¥
**æ·˜æ±°ç®—æ³•**ï¼šLRUã€LFUã€Randomç­‰å¤šç§æ·˜æ±°ç­–ç•¥

### å…³é”®æºç è§£è¯»

```c
// Redisè¿‡æœŸé”®åˆ é™¤ç­–ç•¥
int expireIfNeeded(redisDb *db, robj *key) {
    // æ£€æŸ¥é”®æ˜¯å¦è¿‡æœŸ
    if (!keyIsExpired(db, key)) return 0;
    
    // å¦‚æœæ˜¯ä»èŠ‚ç‚¹ï¼Œä¸ä¸»åŠ¨åˆ é™¤è¿‡æœŸé”®
    if (server.masterhost != NULL) return 1;
    
    // åˆ é™¤è¿‡æœŸé”®
    dbDelete(db, key);
    server.stat_expiredkeys++;
    
    // å‘AOFæ–‡ä»¶å’Œä»èŠ‚ç‚¹ä¼ æ’­DELå‘½ä»¤
    propagateExpire(db, key, server.lazyfree_lazy_expire);
    
    return 1;
}

// LRUæ·˜æ±°ç®—æ³•å®ç°
robj *evictPoolPopBest(dict *sampledict, struct evictionPoolEntry *pool) {
    int j, k, count;
    struct evictionPoolEntry *selected = NULL;
    
    // ä»æ·˜æ±°æ± ä¸­é€‰æ‹©æœ€ä½³å€™é€‰é”®
    for (k = EVPOOL_SIZE-1; k >= 0; k--) {
        if (pool[k].key == NULL) continue;
        selected = &pool[k];
        break;
    }
    
    if (!selected) return NULL;
    
    // è¿”å›è¢«é€‰ä¸­çš„é”®
    robj *key = selected->key;
    selected->key = NULL;
    return key;
}
```

## ğŸ’¡ å®æˆ˜æ¡ˆä¾‹ä¸ä»£ç ç¤ºä¾‹

### å…·ä½“é¡¹ç›®åº”ç”¨

åœ¨ç”µå•†é¡¹ç›®ä¸­ï¼Œå•†å“è¯¦æƒ…é¡µé¢éœ€è¦æ”¯æŒé«˜å¹¶å‘è®¿é—®ã€‚é€šè¿‡Redisç¼“å­˜ä¼˜åŒ–åï¼Œå“åº”æ—¶é—´ä»å¹³å‡200msé™ä½åˆ°5msï¼ŒQPSä»1000æå‡åˆ°10000ã€‚

### å®Œæ•´ä»£ç å®ç°

**ç¼“å­˜å·¥å…·ç±»å®ç°**ï¼š

```java
@Component
public class RedisService {
    
    @Autowired
    private RedisTemplate<String, Object> redisTemplate;
    
    /**
     * Cache-Asideæ¨¡å¼å®ç°
     */
    public <T> T get(String key, Class<T> clazz, Supplier<T> dataLoader, int expireSeconds) {
        // 1. å°è¯•ä»ç¼“å­˜è·å–
        Object cached = redisTemplate.opsForValue().get(key);
        if (cached != null) {
            return JSON.parseObject(cached.toString(), clazz);
        }
        
        // 2. ç¼“å­˜æœªå‘½ä¸­ï¼Œä»æ•°æ®æºåŠ è½½
        T data = dataLoader.get();
        if (data != null) {
            // 3. æ›´æ–°ç¼“å­˜
            redisTemplate.opsForValue().set(key, JSON.toJSONString(data), 
                Duration.ofSeconds(expireSeconds));
        }
        
        return data;
    }
    
    /**
     * é˜²æ­¢ç¼“å­˜å‡»ç©¿çš„åˆ†å¸ƒå¼é”å®ç°
     */
    public <T> T getWithLock(String key, Class<T> clazz, Supplier<T> dataLoader, 
                            int expireSeconds, int lockTimeout) {
        // 1. å°è¯•ä»ç¼“å­˜è·å–
        Object cached = redisTemplate.opsForValue().get(key);
        if (cached != null) {
            return JSON.parseObject(cached.toString(), clazz);
        }
        
        // 2. è·å–åˆ†å¸ƒå¼é”
        String lockKey = "lock:" + key;
        String lockValue = UUID.randomUUID().toString();
        
        Boolean lockAcquired = redisTemplate.opsForValue().setIfAbsent(
            lockKey, lockValue, Duration.ofSeconds(lockTimeout));
            
        if (lockAcquired) {
            try {
                // 3. åŒé‡æ£€æŸ¥
                cached = redisTemplate.opsForValue().get(key);
                if (cached != null) {
                    return JSON.parseObject(cached.toString(), clazz);
                }
                
                // 4. åŠ è½½æ•°æ®å¹¶æ›´æ–°ç¼“å­˜
                T data = dataLoader.get();
                if (data != null) {
                    redisTemplate.opsForValue().set(key, JSON.toJSONString(data), 
                        Duration.ofSeconds(expireSeconds));
                }
                return data;
                
            } finally {
                // 5. é‡Šæ”¾é”
                releaseLock(lockKey, lockValue);
            }
        } else {
            // 6. è·å–é”å¤±è´¥ï¼Œç­‰å¾…åé‡è¯•
            try {
                Thread.sleep(50);
                return get(key, clazz, dataLoader, expireSeconds);
            } catch (InterruptedException e) {
                Thread.currentThread().interrupt();
                return dataLoader.get();
            }
        }
    }
    
    /**
     * å®‰å…¨é‡Šæ”¾åˆ†å¸ƒå¼é”
     */
    private void releaseLock(String lockKey, String lockValue) {
        String script = 
            "if redis.call('get', KEYS[1]) == ARGV[1] then " +
            "    return redis.call('del', KEYS[1]) " +
            "else " +
            "    return 0 " +
            "end";
        redisTemplate.execute(new DefaultRedisScript<>(script, Long.class), 
            Arrays.asList(lockKey), lockValue);
    }
}
```

**å¸ƒéš†è¿‡æ»¤å™¨é˜²æ­¢ç¼“å­˜ç©¿é€**ï¼š

```java
@Component
public class BloomFilterService {
    
    private BloomFilter<String> bloomFilter;
    
    @PostConstruct
    public void init() {
        // åˆå§‹åŒ–å¸ƒéš†è¿‡æ»¤å™¨ï¼šé¢„è®¡1000ä¸‡æ•°æ®ï¼Œè¯¯åˆ¤ç‡0.01%
        bloomFilter = BloomFilter.create(
            Funnels.stringFunnel(Charset.defaultCharset()), 
            10000000, 
            0.0001);
            
        // åŠ è½½å·²å­˜åœ¨çš„æ•°æ®åˆ°å¸ƒéš†è¿‡æ»¤å™¨
        loadExistingData();
    }
    
    public boolean mightContain(String key) {
        return bloomFilter.mightContain(key);
    }
    
    public void put(String key) {
        bloomFilter.put(key);
    }
    
    private void loadExistingData() {
        // ä»æ•°æ®åº“åŠ è½½æ‰€æœ‰å­˜åœ¨çš„keyåˆ°å¸ƒéš†è¿‡æ»¤å™¨
        // è¿™é‡Œå¯ä»¥åˆ†æ‰¹åŠ è½½ä»¥é¿å…å†…å­˜æº¢å‡º
    }
}
```

**å¤šçº§ç¼“å­˜å®ç°**ï¼š

```java
@Service
public class MultiLevelCacheService {
    
    @Autowired
    private RedisService redisService;
    
    @Autowired
    private BloomFilterService bloomFilter;
    
    // æœ¬åœ°ç¼“å­˜
    private final Cache<String, Object> localCache = Caffeine.newBuilder()
        .maximumSize(10000)
        .expireAfterWrite(5, TimeUnit.MINUTES)
        .build();
    
    public <T> T get(String key, Class<T> clazz, Supplier<T> dataLoader) {
        // L1: æœ¬åœ°ç¼“å­˜
        Object cached = localCache.getIfPresent(key);
        if (cached != null) {
            return (T) cached;
        }
        
        // L2: Redisç¼“å­˜
        T data = redisService.get(key, clazz, () -> {
            // L3: å¸ƒéš†è¿‡æ»¤å™¨æ£€æŸ¥
            if (!bloomFilter.mightContain(key)) {
                return null; // æ•°æ®ä¸å­˜åœ¨ï¼Œé¿å…ç¼“å­˜ç©¿é€
            }
            
            // L4: æ•°æ®åº“æŸ¥è¯¢
            return dataLoader.get();
        }, 3600);
        
        // æ›´æ–°æœ¬åœ°ç¼“å­˜
        if (data != null) {
            localCache.put(key, data);
        }
        
        return data;
    }
}
```

## ğŸ¯ é¢è¯•é«˜é¢‘é—®é¢˜ç²¾è®²

### 1. ä»€ä¹ˆæ˜¯ç¼“å­˜ç©¿é€ã€å‡»ç©¿ã€é›ªå´©ï¼Ÿå¦‚ä½•è§£å†³ï¼Ÿ

**æ ‡å‡†ç­”æ¡ˆ**ï¼š

**ç¼“å­˜ç©¿é€**ï¼šæŸ¥è¯¢ä¸å­˜åœ¨çš„æ•°æ®ï¼Œç¼“å­˜å’Œæ•°æ®åº“éƒ½æ²¡æœ‰ï¼Œå¯¼è‡´æ¯æ¬¡éƒ½æŸ¥è¯¢æ•°æ®åº“
- è§£å†³æ–¹æ¡ˆï¼šå¸ƒéš†è¿‡æ»¤å™¨ã€ç©ºå€¼ç¼“å­˜ã€å‚æ•°æ ¡éªŒ

**ç¼“å­˜å‡»ç©¿**ï¼šçƒ­ç‚¹æ•°æ®è¿‡æœŸæ—¶ï¼Œå¤§é‡å¹¶å‘è¯·æ±‚åŒæ—¶è®¿é—®æ•°æ®åº“
- è§£å†³æ–¹æ¡ˆï¼šåˆ†å¸ƒå¼é”ã€çƒ­ç‚¹æ•°æ®æ°¸ä¸è¿‡æœŸã€äº’æ–¥æ›´æ–°

**ç¼“å­˜é›ªå´©**ï¼šå¤§é‡ç¼“å­˜åŒæ—¶è¿‡æœŸï¼Œå¯¼è‡´æ•°æ®åº“å‹åŠ›éª¤å¢
- è§£å†³æ–¹æ¡ˆï¼šè¿‡æœŸæ—¶é—´éšæœºåŒ–ã€å¤šçº§ç¼“å­˜ã€é™æµé™çº§

### 2. Redisç¼“å­˜ä¸€è‡´æ€§å¦‚ä½•ä¿è¯ï¼Ÿ

**æ ‡å‡†ç­”æ¡ˆ**ï¼šç¼“å­˜ä¸€è‡´æ€§çš„å‡ ç§ç­–ç•¥ï¼š

**å¼ºä¸€è‡´æ€§**ï¼š
- è¯»å†™é”æœºåˆ¶
- åˆ†å¸ƒå¼äº‹åŠ¡
- é€‚ç”¨äºå¯¹ä¸€è‡´æ€§è¦æ±‚æé«˜çš„åœºæ™¯

**å¼±ä¸€è‡´æ€§**ï¼š
- è®¾ç½®åˆç†çš„è¿‡æœŸæ—¶é—´
- å®šæ—¶åˆ·æ–°ç¼“å­˜
- é€‚ç”¨äºå¯¹ä¸€è‡´æ€§è¦æ±‚ä¸é«˜çš„åœºæ™¯

**æœ€ç»ˆä¸€è‡´æ€§**ï¼š
- å¼‚æ­¥æ›´æ–°ç¼“å­˜
- æ¶ˆæ¯é˜Ÿåˆ—é€šçŸ¥
- é€‚ç”¨äºå¤§å¤šæ•°ä¸šåŠ¡åœºæ™¯

### 3. å¦‚ä½•è®¾è®¡ä¸€ä¸ªé«˜å¯ç”¨çš„ç¼“å­˜ç³»ç»Ÿï¼Ÿ

**æ ‡å‡†ç­”æ¡ˆ**ï¼šé«˜å¯ç”¨ç¼“å­˜ç³»ç»Ÿè®¾è®¡è¦ç‚¹ï¼š

**æ¶æ„å±‚é¢**ï¼š
- ä¸»ä»å¤åˆ¶ä¿è¯æ•°æ®å®‰å…¨
- å“¨å…µæ¨¡å¼å®ç°è‡ªåŠ¨æ•…éšœè½¬ç§»
- é›†ç¾¤æ¨¡å¼æä¾›æ°´å¹³æ‰©å±•èƒ½åŠ›

**åº”ç”¨å±‚é¢**ï¼š
- å¤šçº§ç¼“å­˜é™ä½å•ç‚¹é£é™©
- ç†”æ–­é™çº§ä¿æŠ¤åç«¯æœåŠ¡
- ç›‘æ§å‘Šè­¦åŠæ—¶å‘ç°é—®é¢˜

**è¿ç»´å±‚é¢**ï¼š
- å®šæœŸå¤‡ä»½å’Œæ¼”ç»ƒ
- å®¹é‡è§„åˆ’å’Œæ€§èƒ½è°ƒä¼˜
- å®‰å…¨ç­–ç•¥å’Œè®¿é—®æ§åˆ¶

### 4. Redisçš„å†…å­˜æ·˜æ±°ç­–ç•¥æœ‰å“ªäº›ï¼Ÿ

**æ ‡å‡†ç­”æ¡ˆ**ï¼šRedisæä¾›äº†8ç§å†…å­˜æ·˜æ±°ç­–ç•¥ï¼š

**é’ˆå¯¹æ‰€æœ‰key**ï¼š
- `allkeys-lru`ï¼šä½¿ç”¨LRUç®—æ³•æ·˜æ±°ä»»æ„key
- `allkeys-lfu`ï¼šä½¿ç”¨LFUç®—æ³•æ·˜æ±°ä»»æ„key  
- `allkeys-random`ï¼šéšæœºæ·˜æ±°ä»»æ„key

**é’ˆå¯¹è®¾ç½®è¿‡æœŸæ—¶é—´çš„key**ï¼š
- `volatile-lru`ï¼šä½¿ç”¨LRUç®—æ³•æ·˜æ±°è¿‡æœŸkey
- `volatile-lfu`ï¼šä½¿ç”¨LFUç®—æ³•æ·˜æ±°è¿‡æœŸkey
- `volatile-random`ï¼šéšæœºæ·˜æ±°è¿‡æœŸkey
- `volatile-ttl`ï¼šæ·˜æ±°å³å°†è¿‡æœŸçš„key

**ä¸æ·˜æ±°**ï¼š
- `noeviction`ï¼šä¸æ·˜æ±°ï¼Œå†…å­˜æ»¡æ—¶è¿”å›é”™è¯¯

**é€‰æ‹©å»ºè®®**ï¼šä¸€èˆ¬æ¨èä½¿ç”¨`allkeys-lru`ï¼Œå…¼é¡¾æ€§èƒ½å’Œæ•ˆæœã€‚

### 5. å¦‚ä½•ä¼˜åŒ–Redisæ€§èƒ½ï¼Ÿ

**æ ‡å‡†ç­”æ¡ˆ**ï¼šRedisæ€§èƒ½ä¼˜åŒ–çš„å¤šä¸ªç»´åº¦ï¼š

**æ•°æ®ç»“æ„ä¼˜åŒ–**ï¼š
```redis
# ä½¿ç”¨åˆé€‚çš„æ•°æ®ç»“æ„
HSET user:1001 name "å¼ ä¸‰" age 25  # è€Œä¸æ˜¯å¤šä¸ªSTRING
```

**å†…å­˜ä¼˜åŒ–**ï¼š
```redis
# é…ç½®å†…å­˜ä¼˜åŒ–å‚æ•°
hash-max-ziplist-entries 512
hash-max-ziplist-value 64
```

**ç½‘ç»œä¼˜åŒ–**ï¼š
```redis
# ä½¿ç”¨pipelineæ‰¹é‡æ“ä½œ
MULTI
SET key1 value1  
SET key2 value2
EXEC
```

**æŒä¹…åŒ–ä¼˜åŒ–**ï¼š
```redis
# æ ¹æ®éœ€æ±‚é€‰æ‹©æŒä¹…åŒ–ç­–ç•¥
save 900 1      # RDBé…ç½®
appendonly yes  # AOFé…ç½®
```

## âš¡ æ€§èƒ½ä¼˜åŒ–ä¸æ³¨æ„äº‹é¡¹

### æ€§èƒ½ç“¶é¢ˆåˆ†æ

**å¸¸è§æ€§èƒ½ç“¶é¢ˆ**ï¼š
1. **å†…å­˜ä½¿ç”¨è¿‡é«˜**ï¼šæ•°æ®ç»“æ„é€‰æ‹©ä¸å½“ã€è¿‡æœŸç­–ç•¥é…ç½®é—®é¢˜
2. **ç½‘ç»œå»¶è¿Ÿ**ï¼šé¢‘ç¹çš„å°è¯·æ±‚ã€ç¼ºå°‘æ‰¹é‡æ“ä½œ
3. **CPUå ç”¨é«˜**ï¼šå¤æ‚æ“ä½œã€å¤§keyé—®é¢˜
4. **æŒä¹…åŒ–å½±å“**ï¼šRDB/AOFé…ç½®ä¸å½“

### ä¼˜åŒ–ç­–ç•¥æ–¹æ¡ˆ

**é”®å€¼è®¾è®¡ä¼˜åŒ–**ï¼š
```java
// å¥½çš„è®¾è®¡ï¼šä½¿ç”¨Hashå­˜å‚¨ç”¨æˆ·ä¿¡æ¯
jedis.hset("user:1001", "name", "å¼ ä¸‰");
jedis.hset("user:1001", "age", "25");

// ä¸å¥½çš„è®¾è®¡ï¼šä½¿ç”¨å¤šä¸ªString
jedis.set("user:1001:name", "å¼ ä¸‰");
jedis.set("user:1001:age", "25");
```

**æ‰¹é‡æ“ä½œä¼˜åŒ–**ï¼š
```java
// ä½¿ç”¨Pipelineæ‰¹é‡æ“ä½œ
Pipeline pipeline = jedis.pipelined();
for (int i = 0; i < 1000; i++) {
    pipeline.set("key" + i, "value" + i);
}
pipeline.sync();
```

### å¸¸è§å‘ç‚¹è§„é¿

**å¤§keyé—®é¢˜**ï¼š
- é¿å…å­˜å‚¨è¿‡å¤§çš„valueï¼ˆ>10MBï¼‰
- ä½¿ç”¨SCANä»£æ›¿KEYSå‘½ä»¤
- åˆç†è®¾è®¡æ•°æ®ç»“æ„

**çƒ­keyé—®é¢˜**ï¼š
- ä½¿ç”¨æœ¬åœ°ç¼“å­˜å‡å°‘Redisè®¿é—®
- çƒ­keyæ‹†åˆ†ä¸ºå¤šä¸ªkey
- ä½¿ç”¨ä¸€è‡´æ€§å“ˆå¸Œåˆ†æ•£çƒ­ç‚¹

**è¿‡æœŸæ—¶é—´è®¾è®¡**ï¼š
```java
// é¿å…åŒæ—¶è¿‡æœŸ
int baseExpire = 3600;
int randomExpire = new Random().nextInt(300); // 0-300ç§’éšæœº
jedis.setex(key, baseExpire + randomExpire, value);
```

## ğŸ“š æ€»ç»“ä¸æŠ€æœ¯å¯¹æ¯”

### æ ¸å¿ƒè¦ç‚¹å›é¡¾

Redisç¼“å­˜è®¾è®¡éœ€è¦æŒæ¡ï¼š**ç¼“å­˜æ¨¡å¼é€‰æ‹©**ã€**ä¸€è‡´æ€§ç­–ç•¥**ã€**æ€§èƒ½ä¼˜åŒ–**ã€**é«˜å¯ç”¨è®¾è®¡**ã€**é—®é¢˜æ’æŸ¥**ç­‰æ ¸å¿ƒæŠ€èƒ½ã€‚

### ä¸ç›¸å…³æŠ€æœ¯å¯¹æ¯”

| ç‰¹æ€§ | Redis | Memcached | Caffeine | Hazelcast |
|------|-------|-----------|----------|-----------|
| æ•°æ®ç»“æ„ | ä¸°å¯Œ | ç®€å• | ç®€å• | ä¸°å¯Œ |
| æŒä¹…åŒ– | æ”¯æŒ | ä¸æ”¯æŒ | ä¸æ”¯æŒ | æ”¯æŒ |
| é›†ç¾¤ | åŸç”Ÿæ”¯æŒ | éœ€è¦å®¢æˆ·ç«¯ | å•æœº | åŸç”Ÿæ”¯æŒ |
| æ€§èƒ½ | é«˜ | æé«˜ | æé«˜ | é«˜ |
| åŠŸèƒ½ | å…¨é¢ | ç®€å• | ç®€å• | å…¨é¢ |

### æŒç»­å­¦ä¹ å»ºè®®

**æ·±å…¥å­¦ä¹ æ–¹å‘**ï¼š
1. **Redisæºç åˆ†æ**ï¼šç†è§£åº•å±‚å®ç°åŸç†
2. **åˆ†å¸ƒå¼ç¼“å­˜æ¶æ„**ï¼šå­¦ä¹ å¤§è§„æ¨¡ç¼“å­˜ç³»ç»Ÿè®¾è®¡
3. **ç¼“å­˜æ–°æŠ€æœ¯**ï¼šå…³æ³¨Redisæ–°ç‰ˆæœ¬ç‰¹æ€§
4. **æ€§èƒ½è°ƒä¼˜å®æˆ˜**ï¼šç§¯ç´¯å®é™…ä¼˜åŒ–ç»éªŒ

**å®è·µå»ºè®®**ï¼š
ä»ç®€å•çš„Cache-Asideæ¨¡å¼å¼€å§‹ï¼Œé€æ­¥æŒæ¡å¤æ‚çš„ç¼“å­˜è®¾è®¡æ¨¡å¼ã€‚é‡è§†ç›‘æ§å’Œæ€§èƒ½åˆ†æï¼Œå»ºç«‹å®Œå–„çš„ç¼“å­˜è¿ç»´ä½“ç³»ã€‚ 