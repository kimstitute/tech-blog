---
title: "åƒåœ¾å›æ”¶ç®—æ³•ä¸GCè°ƒä¼˜å®æˆ˜æ·±åº¦è§£æ"
description: "æ·±å…¥è§£æJVMåƒåœ¾å›æ”¶ç®—æ³•çš„è®¾è®¡åŸç†ã€å„ç§GCæ”¶é›†å™¨çš„ç‰¹ç‚¹å’Œé€‚ç”¨åœºæ™¯ã€‚ç»“åˆå®é™…é¡¹ç›®ç»éªŒåˆ†äº«GCè°ƒä¼˜ç­–ç•¥ã€æ€§èƒ½ç›‘æ§æ–¹æ³•ï¼ŒæŒæ¡ç”Ÿäº§ç¯å¢ƒGCé—®é¢˜è¯Šæ–­å’Œè§£å†³æ–¹æ¡ˆã€‚"
pubDate: 2024-12-10
updatedDate: 2024-12-10
tags: ["java", "jvm", "gc", "garbage-collection", "performance", "tuning", "g1", "cms", "zgc", "memory-management", "interview", "best-practices"]
categories: ["java-core"]
subject: "JVMå†…å­˜æ¨¡å‹"
draft: false
featured: true
author: "Gerrad Zhang"
location: "æ­¦æ±‰ï¼Œä¸­å›½"
---

## ğŸ¤” é—®é¢˜èƒŒæ™¯ä¸æŠ€æœ¯æ¼”è¿›

### æˆ‘ä»¬è¦è§£å†³ä»€ä¹ˆé—®é¢˜ï¼Ÿ

åœ¨Javaåº”ç”¨å¼€å‘ä¸­ï¼Œ**åƒåœ¾å›æ”¶ï¼ˆGarbage Collection, GCï¼‰**æ˜¯è‡ªåŠ¨å†…å­˜ç®¡ç†çš„æ ¸å¿ƒæœºåˆ¶ï¼Œä½†ä¹Ÿæ˜¯æ€§èƒ½ä¼˜åŒ–çš„å…³é”®ç“¶é¢ˆã€‚ä¸åˆé€‚çš„GCç­–ç•¥ä¼šå¯¼è‡´ä¸¥é‡çš„æ€§èƒ½é—®é¢˜ï¼š

- **Stop-The-Worldåœé¡¿è¿‡é•¿**ï¼šå½±å“åº”ç”¨å“åº”æ—¶é—´å’Œç”¨æˆ·ä½“éªŒ
- **GCé¢‘ç‡è¿‡é«˜**ï¼šæ¶ˆè€—å¤§é‡CPUèµ„æºï¼Œé™ä½åº”ç”¨ååé‡
- **å†…å­˜å›æ”¶ä¸åŠæ—¶**ï¼šå¯¼è‡´å†…å­˜æ³„æ¼å’ŒOOMå¼‚å¸¸
- **GCè°ƒä¼˜å¤æ‚**ï¼šå‚æ•°ä¼—å¤šï¼Œç¼ºä¹ç³»ç»Ÿæ€§çš„è°ƒä¼˜æ–¹æ³•

```java
// å¸¸è§çš„GCæ€§èƒ½é—®é¢˜ç¤ºä¾‹
public class GCPerformanceProblems {
    
    /**
     * é—®é¢˜1ï¼šé¢‘ç¹çš„Young GC
     */
    public void demonstrateFrequentYoungGC() {
        // âŒ å¤§é‡çŸ­ç”Ÿå‘½å‘¨æœŸå¯¹è±¡åˆ›å»º
        for (int i = 0; i < 1000000; i++) {
            String temp = new String("ä¸´æ—¶å¯¹è±¡" + i); // é¢‘ç¹åˆ›å»ºå¯¹è±¡
            List<String> tempList = new ArrayList<>(); // ä¸´æ—¶é›†åˆ
            tempList.add(temp);
            // å¯¹è±¡å¾ˆå¿«å˜æˆåƒåœ¾ï¼Œå¯¼è‡´é¢‘ç¹Young GC
        }
        
        // ç»“æœï¼šYoung GCé¢‘ç‡è¿‡é«˜ï¼Œå½±å“åº”ç”¨æ€§èƒ½
        // è§£å†³ï¼šå¯¹è±¡æ± ã€StringBuilderä¼˜åŒ–ã€è°ƒæ•´å¹´è½»ä»£å¤§å°
    }
    
    /**
     * é—®é¢˜2ï¼šFull GCé¢‘ç¹è§¦å‘
     */
    public void demonstrateFrequentFullGC() {
        // âŒ å¤§å¯¹è±¡ç›´æ¥è¿›å…¥è€å¹´ä»£
        List<byte[]> largeObjects = new ArrayList<>();
        
        for (int i = 0; i < 100; i++) {
            byte[] largeArray = new byte[10 * 1024 * 1024]; // 10MBå¤§å¯¹è±¡
            largeObjects.add(largeArray);
            // å¤§å¯¹è±¡ç›´æ¥åˆ†é…åˆ°è€å¹´ä»£ï¼Œå¿«é€Ÿå¡«æ»¡
        }
        
        // ç»“æœï¼šè€å¹´ä»£å¿«é€Ÿå¡«æ»¡ï¼Œé¢‘ç¹è§¦å‘Full GC
        // è§£å†³ï¼šè°ƒæ•´å¤§å¯¹è±¡é˜ˆå€¼ã€å¢å¤§è€å¹´ä»£ã€ä¼˜åŒ–å¯¹è±¡å¤§å°
    }
}
```

### æ²¡æœ‰è¿™ä¸ªæŠ€æœ¯æ—¶æ˜¯æ€ä¹ˆåšçš„ï¼Ÿ

åœ¨è‡ªåŠ¨åƒåœ¾å›æ”¶å‡ºç°ä¹‹å‰ï¼Œå†…å­˜ç®¡ç†å®Œå…¨ä¾èµ–ç¨‹åºå‘˜æ‰‹åŠ¨æ“ä½œï¼š

#### æ‰‹åŠ¨å†…å­˜ç®¡ç†ï¼ˆC/C++ï¼‰
- ä½¿ç”¨malloc/freeã€new/deleteæ‰‹åŠ¨åˆ†é…é‡Šæ”¾å†…å­˜
- **é—®é¢˜**ï¼šå†…å­˜æ³„æ¼ã€é‡æŒ‡é’ˆã€åŒé‡é‡Šæ”¾ç­‰é—®é¢˜é¢‘å‘

**2. å¼•ç”¨è®¡æ•°æ³•**
- ä¸ºæ¯ä¸ªå¯¹è±¡ç»´æŠ¤å¼•ç”¨è®¡æ•°å™¨
- **é—®é¢˜**ï¼šæ— æ³•å¤„ç†å¾ªç¯å¼•ç”¨ï¼Œæ€§èƒ½å¼€é”€å¤§

**3. ç®€å•æ ‡è®°æ¸…é™¤**
- æ ‡è®°æ‰€æœ‰å¯è¾¾å¯¹è±¡ï¼Œæ¸…é™¤ä¸å¯è¾¾å¯¹è±¡
- **é—®é¢˜**ï¼šåœé¡¿æ—¶é—´é•¿ï¼Œå†…å­˜ç¢ç‰‡ä¸¥é‡

### æŠ€æœ¯æ¼”è¿›çš„å†å²è„‰ç»œ

**2000å¹´ä»£æ—©æœŸ**: å¹¶å‘å’Œå¢é‡å›æ”¶
- CMSåƒåœ¾å›æ”¶å™¨å¼•å…¥
- å¹¶å‘æ ‡è®°å’Œæ¸…é™¤
- å‡å°‘åœé¡¿æ—¶é—´

**2010å¹´ä»£**: ä½å»¶è¿Ÿå’Œå¤§å †æ”¯æŒ
- G1åƒåœ¾å›æ”¶å™¨æˆç†Ÿ
- åˆ†åŒºå›æ”¶ç­–ç•¥
- å¯é¢„æµ‹çš„åœé¡¿æ—¶é—´

**2020å¹´ä»£**: è¶…ä½å»¶è¿Ÿå›æ”¶å™¨
- ZGCå’ŒShenandoahå¼•å…¥
- åœé¡¿æ—¶é—´<10ms
- æ”¯æŒTBçº§åˆ«å †å†…å­˜

## ğŸ¯ æ ¸å¿ƒæ¦‚å¿µä¸åŸç†

### åŸºç¡€æ¦‚å¿µå®šä¹‰

**åƒåœ¾å›æ”¶ï¼ˆGarbage Collectionï¼‰**æ˜¯JVMè‡ªåŠ¨ç®¡ç†å†…å­˜çš„æœºåˆ¶ï¼Œé€šè¿‡è¯†åˆ«å’Œå›æ”¶ä¸å†è¢«ç¨‹åºå¼•ç”¨çš„å¯¹è±¡æ¥é‡Šæ”¾å†…å­˜ç©ºé—´ï¼Œé¿å…å†…å­˜æ³„æ¼å’Œæ‰‹åŠ¨å†…å­˜ç®¡ç†çš„å¤æ‚æ€§ã€‚

**æ ¸å¿ƒç‰¹æ€§**ï¼š
- **è‡ªåŠ¨åŒ–**ï¼šæ— éœ€ç¨‹åºå‘˜æ‰‹åŠ¨é‡Šæ”¾å†…å­˜
- **å®‰å…¨æ€§**ï¼šé¿å…å†…å­˜æ³„æ¼å’Œé‡æŒ‡é’ˆé—®é¢˜
- **é€æ˜æ€§**ï¼šå¯¹åº”ç”¨ç¨‹åºåŸºæœ¬é€æ˜
- **å¯è°ƒä¼˜**ï¼šæä¾›ä¸°å¯Œçš„å‚æ•°è¿›è¡Œæ€§èƒ½è°ƒä¼˜

### åƒåœ¾å›æ”¶ç®—æ³•åŸç†

#### æ ‡è®°-æ¸…é™¤ç®—æ³•ï¼ˆMark-Sweepï¼‰

```java
/**
 * æ ‡è®°-æ¸…é™¤ç®—æ³•å®ç°åŸç†
 */
public class MarkSweepAlgorithm {
    
    /**
     * æ ‡è®°-æ¸…é™¤ç®—æ³•çš„å·¥ä½œæµç¨‹
     */
    public void analyzeMarkSweepProcess() {
        /*
         * æ ‡è®°-æ¸…é™¤ç®—æ³•æ‰§è¡Œè¿‡ç¨‹ï¼š
         * 
         * ç¬¬ä¸€é˜¶æ®µï¼šæ ‡è®°é˜¶æ®µ
         * â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         * â”‚ 1. ä»GC Rootså¼€å§‹éå†å¯¹è±¡å›¾                  â”‚
         * â”‚    GC RootsåŒ…æ‹¬ï¼š                           â”‚
         * â”‚    - è™šæ‹Ÿæœºæ ˆä¸­çš„å¼•ç”¨                       â”‚
         * â”‚    - æ–¹æ³•åŒºä¸­çš„é™æ€å¼•ç”¨                     â”‚
         * â”‚    - æ–¹æ³•åŒºä¸­çš„å¸¸é‡å¼•ç”¨                     â”‚
         * â”‚    - æœ¬åœ°æ–¹æ³•æ ˆä¸­çš„å¼•ç”¨                     â”‚
         * â”‚                                             â”‚
         * â”‚ 2. æ ‡è®°æ‰€æœ‰å¯è¾¾çš„å¯¹è±¡                       â”‚
         * â”‚    ä½¿ç”¨æ·±åº¦ä¼˜å…ˆæœç´¢æˆ–å¹¿åº¦ä¼˜å…ˆæœç´¢           â”‚
         * â”‚    å°†å¯è¾¾å¯¹è±¡çš„å¯¹è±¡å¤´æ ‡è®°ä½è®¾ç½®ä¸º1          â”‚
         * â”‚                                             â”‚
         * â”‚ 3. éå†å®Œæˆåï¼Œæœªæ ‡è®°çš„å¯¹è±¡å³ä¸ºåƒåœ¾         â”‚
         * â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         * 
         * ç¬¬äºŒé˜¶æ®µï¼šæ¸…é™¤é˜¶æ®µ
         * â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         * â”‚ 1. éå†æ•´ä¸ªå †å†…å­˜                           â”‚
         * â”‚    æŒ‰åœ°å€é¡ºåºæ‰«ææ‰€æœ‰å†…å­˜åŒºåŸŸ               â”‚
         * â”‚                                             â”‚
         * â”‚ 2. å›æ”¶æœªæ ‡è®°çš„å¯¹è±¡                         â”‚
         * â”‚    å°†åƒåœ¾å¯¹è±¡çš„å†…å­˜ç©ºé—´åŠ å…¥ç©ºé—²åˆ—è¡¨         â”‚
         * â”‚                                             â”‚
         * â”‚ 3. é‡ç½®æ ‡è®°ä½                               â”‚
         * â”‚    å°†å­˜æ´»å¯¹è±¡çš„æ ‡è®°ä½é‡ç½®ä¸º0                â”‚
         * â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         * 
         * ç®—æ³•ç‰¹ç‚¹ï¼š
         * âœ… ä¼˜ç‚¹ï¼š
         *   - å®ç°ç®€å•ï¼Œé€»è¾‘æ¸…æ™°
         *   - ä¸éœ€è¦é¢å¤–çš„å†…å­˜ç©ºé—´
         *   - å¯ä»¥å›æ”¶å¾ªç¯å¼•ç”¨çš„å¯¹è±¡
         * 
         * âŒ ç¼ºç‚¹ï¼š
         *   - æ•ˆç‡è¾ƒä½ï¼Œéœ€è¦æ‰«ææ•´ä¸ªå †
         *   - äº§ç”Ÿå†…å­˜ç¢ç‰‡
         *   - åœé¡¿æ—¶é—´ä¸å †å¤§å°æˆæ­£æ¯”
         */
    }
}
```

#### å¤åˆ¶ç®—æ³•ï¼ˆCopyingï¼‰

```java
/**
 * å¤åˆ¶ç®—æ³•å®ç°åŸç†
 */
public class CopyingAlgorithm {
    
    /**
     * å¤åˆ¶ç®—æ³•çš„å·¥ä½œæµç¨‹
     */
    public void analyzeCopyingProcess() {
        /*
         * å¤åˆ¶ç®—æ³•æ‰§è¡Œè¿‡ç¨‹ï¼š
         * 
         * åˆå§‹çŠ¶æ€ï¼šå†…å­˜åˆ†ä¸ºä¸¤ä¸ªç›¸ç­‰çš„åŒºåŸŸ
         * â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         * â”‚   From Space    â”‚ â”‚    To Space     â”‚
         * â”‚ â”Œâ”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”   â”‚ â”‚                 â”‚
         * â”‚ â”‚Obj1 â”‚Obj2 â”‚   â”‚ â”‚     (ç©ºé—²)      â”‚
         * â”‚ â”‚Obj3 â”‚Obj4 â”‚   â”‚ â”‚                 â”‚
         * â”‚ â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”˜   â”‚ â”‚                 â”‚
         * â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         * 
         * ç¬¬ä¸€æ­¥ï¼šæ ‡è®°å­˜æ´»å¯¹è±¡
         * â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         * â”‚   From Space    â”‚ â”‚    To Space     â”‚
         * â”‚ â”Œâ”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”   â”‚ â”‚                 â”‚
         * â”‚ â”‚Obj1âœ“â”‚Obj2âœ—â”‚   â”‚ â”‚     (ç©ºé—²)      â”‚
         * â”‚ â”‚Obj3âœ“â”‚Obj4âœ—â”‚   â”‚ â”‚                 â”‚
         * â”‚ â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”˜   â”‚ â”‚                 â”‚
         * â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         * 
         * ç¬¬äºŒæ­¥ï¼šå¤åˆ¶å­˜æ´»å¯¹è±¡åˆ°To Space
         * â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         * â”‚   From Space    â”‚ â”‚    To Space     â”‚
         * â”‚                 â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”   â”‚
         * â”‚     (å¾…æ¸…ç†)     â”‚ â”‚ â”‚Obj1 â”‚Obj3 â”‚   â”‚
         * â”‚                 â”‚ â”‚ â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”˜   â”‚
         * â”‚                 â”‚ â”‚                 â”‚
         * â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         * 
         * ç®—æ³•ç‰¹ç‚¹ï¼š
         * âœ… ä¼˜ç‚¹ï¼š
         *   - æ²¡æœ‰å†…å­˜ç¢ç‰‡
         *   - åˆ†é…ç®€å•ï¼Œåªéœ€ç§»åŠ¨æŒ‡é’ˆ
         *   - å¤åˆ¶è¿‡ç¨‹ä¸­è‡ªåŠ¨å®Œæˆå†…å­˜æ•´ç†
         * 
         * âŒ ç¼ºç‚¹ï¼š
         *   - å†…å­˜åˆ©ç”¨ç‡åªæœ‰50%
         *   - å¯¹è±¡å­˜æ´»ç‡é«˜æ—¶æ•ˆç‡ä½
         *   - éœ€è¦é¢å¤–ç©ºé—´ä½œä¸ºå¤åˆ¶ç¼“å†²åŒº
         */
    }
}
```

#### æ ‡è®°-æ•´ç†ç®—æ³•ï¼ˆMark-Compactï¼‰

```java
/**
 * æ ‡è®°-æ•´ç†ç®—æ³•å®ç°åŸç†
 */
public class MarkCompactAlgorithm {
    
    /**
     * æ ‡è®°-æ•´ç†ç®—æ³•çš„å·¥ä½œæµç¨‹
     */
    public void analyzeMarkCompactProcess() {
        /*
         * æ ‡è®°-æ•´ç†ç®—æ³•æ‰§è¡Œè¿‡ç¨‹ï¼š
         * 
         * ç¬¬ä¸€é˜¶æ®µï¼šæ ‡è®°é˜¶æ®µï¼ˆä¸æ ‡è®°-æ¸…é™¤ç›¸åŒï¼‰
         * â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         * â”‚ ä»GC Rootså¼€å§‹æ ‡è®°æ‰€æœ‰å¯è¾¾å¯¹è±¡               â”‚
         * â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         * 
         * ç¬¬äºŒé˜¶æ®µï¼šæ•´ç†é˜¶æ®µ
         * 
         * æ•´ç†å‰çš„å†…å­˜å¸ƒå±€ï¼š
         * â”Œâ”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”
         * â”‚ Obj1 â”‚ åƒåœ¾ â”‚ Obj3 â”‚ åƒåœ¾ â”‚ Obj5 â”‚ åƒåœ¾ â”‚
         * â”‚(å­˜æ´»)â”‚      â”‚(å­˜æ´»)â”‚      â”‚(å­˜æ´»)â”‚      â”‚
         * â””â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”˜
         * 
         * æ•´ç†åçš„å†…å­˜å¸ƒå±€ï¼š
         * â”Œâ”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         * â”‚ Obj1 â”‚ Obj3 â”‚ Obj5 â”‚        ç©ºé—²ç©ºé—´       â”‚
         * â”‚(å­˜æ´»)â”‚(å­˜æ´»)â”‚(å­˜æ´»)â”‚                      â”‚
         * â””â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         * 
         * ç®—æ³•ç‰¹ç‚¹ï¼š
         * âœ… ä¼˜ç‚¹ï¼š
         *   - æ²¡æœ‰å†…å­˜ç¢ç‰‡
         *   - å†…å­˜åˆ©ç”¨ç‡é«˜ï¼ˆ100%ï¼‰
         *   - é€‚åˆå­˜æ´»ç‡é«˜çš„åœºæ™¯
         * 
         * âŒ ç¼ºç‚¹ï¼š
         *   - æ•´ç†è¿‡ç¨‹å¤æ‚ï¼Œéœ€è¦ç§»åŠ¨å¯¹è±¡
         *   - åœé¡¿æ—¶é—´è¾ƒé•¿
         *   - éœ€è¦æ›´æ–°æ‰€æœ‰å¼•ç”¨
         */
    }
}
```

### åˆ†ä»£åƒåœ¾å›æ”¶ç†è®º

**åˆ†ä»£å‡è®¾ï¼ˆGenerational Hypothesisï¼‰**ï¼š

```java
/**
 * åˆ†ä»£åƒåœ¾å›æ”¶ç†è®ºåˆ†æ
 */
public class GenerationalGCTheory {
    
    /**
     * åˆ†ä»£å‡è®¾çš„ç†è®ºåŸºç¡€
     */
    public void analyzeGenerationalHypothesis() {
        /*
         * åˆ†ä»£å‡è®¾çš„ä¸¤ä¸ªæ ¸å¿ƒè§‚å¯Ÿï¼š
         * 
         * 1. å¼±åˆ†ä»£å‡è®¾ï¼ˆWeak Generational Hypothesisï¼‰ï¼š
         *    "å¤§å¤šæ•°å¯¹è±¡åœ¨å¹´è½»æ—¶å°±ä¼šæ­»äº¡"
         * 
         *    ç»Ÿè®¡æ•°æ®æ”¯æŒï¼š
         *    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         *    â”‚ å¯¹è±¡å­˜æ´»æ—¶é—´åˆ†å¸ƒï¼š               â”‚
         *    â”‚                                â”‚
         *    â”‚ 98% â”‚â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  â”‚ â† ç¬¬ä¸€æ¬¡GCåæ­»äº¡
         *    â”‚  1% â”‚â–ˆ                         â”‚ â† å­˜æ´»1-2æ¬¡GC
         *    â”‚  1% â”‚â–ˆ                         â”‚ â† é•¿æœŸå­˜æ´»
         *    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         * 
         * 2. å¼ºåˆ†ä»£å‡è®¾ï¼ˆStrong Generational Hypothesisï¼‰ï¼š
         *    "è€å¯¹è±¡å¾ˆå°‘å¼•ç”¨å¹´è½»å¯¹è±¡"
         * 
         *    è·¨ä»£å¼•ç”¨ç»Ÿè®¡ï¼š
         *    - è€å¹´ä»£â†’å¹´è½»ä»£å¼•ç”¨ï¼š< 1%
         *    - å¹´è½»ä»£â†’è€å¹´ä»£å¼•ç”¨ï¼šçº¦ 15%
         *    - åŒä»£å†…å¼•ç”¨ï¼š> 84%
         * 
         * åŸºäºå‡è®¾çš„ä¼˜åŒ–ç­–ç•¥ï¼š
         * 
         * 1. åˆ†ä»£æ”¶é›†ï¼š
         *    - å¹´è½»ä»£ï¼šé¢‘ç¹GCï¼Œä½¿ç”¨å¤åˆ¶ç®—æ³•
         *    - è€å¹´ä»£ï¼šè¾ƒå°‘GCï¼Œä½¿ç”¨æ ‡è®°-æ•´ç†ç®—æ³•
         * 
         * 2. è®°å¿†é›†ï¼ˆRemembered Setï¼‰ï¼š
         *    - è®°å½•è·¨ä»£å¼•ç”¨å…³ç³»
         *    - é¿å…æ‰«ææ•´ä¸ªè€å¹´ä»£
         *    - æé«˜å¹´è½»ä»£GCæ•ˆç‡
         * 
         * 3. å¡è¡¨ï¼ˆCard Tableï¼‰ï¼š
         *    - å°†å†…å­˜åˆ’åˆ†ä¸ºå›ºå®šå¤§å°çš„å¡ç‰‡
         *    - æ ‡è®°åŒ…å«è·¨ä»£å¼•ç”¨çš„å¡ç‰‡
         *    - åªæ‰«ææ ‡è®°çš„å¡ç‰‡
         */
    }
}
```

## ğŸ”§ å®ç°åŸç†ä¸æºç åˆ†æ

### ç°ä»£åƒåœ¾å›æ”¶å™¨å®ç°

#### G1åƒåœ¾å›æ”¶å™¨

```java
/**
 * G1åƒåœ¾å›æ”¶å™¨å®ç°åˆ†æ
 */
public class G1GarbageCollector {
    
    /**
     * G1çš„è®¾è®¡ç†å¿µå’Œæ¶æ„
     */
    public void analyzeG1Architecture() {
        /*
         * G1 (Garbage First) è®¾è®¡ç†å¿µï¼š
         * 
         * 1. åˆ†åŒºç®¡ç† (Region-based)ï¼š
         * â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         * â”‚              G1 Heap Layout                â”‚
         * â”œâ”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
         * â”‚  E  â”‚  S  â”‚  O  â”‚  O  â”‚  E  â”‚  S  â”‚    H    â”‚
         * â”œâ”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
         * â”‚  O  â”‚  E  â”‚  E  â”‚  S  â”‚  O  â”‚  O  â”‚    H    â”‚
         * â”œâ”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
         * â”‚  E  â”‚  O  â”‚  S  â”‚  E  â”‚  E  â”‚  O  â”‚   Free  â”‚
         * â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         * 
         * E = Eden Region      S = Survivor Region
         * O = Old Region       H = Humongous Region
         * 
         * 2. åˆ†åŒºç‰¹ç‚¹ï¼š
         *    - æ¯ä¸ªåˆ†åŒºå¤§å°ç›¸ç­‰ï¼ˆ1MB-32MBï¼‰
         *    - åˆ†åŒºè§’è‰²å¯ä»¥åŠ¨æ€å˜åŒ–
         *    - ä¸è¦æ±‚ç‰©ç†ä¸Šè¿ç»­çš„åˆ†ä»£
         * 
         * 3. ä¼˜å…ˆçº§å›æ”¶ç­–ç•¥ï¼š
         *    - ç»´æŠ¤æ¯ä¸ªåˆ†åŒºçš„å›æ”¶ä»·å€¼
         *    - ä¼˜å…ˆå›æ”¶åƒåœ¾æœ€å¤šçš„åˆ†åŒº
         *    - åœ¨åœé¡¿æ—¶é—´é™åˆ¶å†…å›æ”¶ä»·å€¼æœ€å¤§çš„åˆ†åŒº
         */
    }
    
    /**
     * G1çš„å…³é”®æŠ€æœ¯
     */
    public void analyzeG1KeyTechnologies() {
        /*
         * 1. è®°å¿†é›† (Remembered Set)ï¼š
         *    - æ¯ä¸ªåˆ†åŒºç»´æŠ¤ä¸€ä¸ªè®°å¿†é›†
         *    - è®°å½•å…¶ä»–åˆ†åŒºå¯¹æœ¬åˆ†åŒºçš„å¼•ç”¨
         *    - é¿å…æ‰«ææ•´ä¸ªå †æ¥å¯»æ‰¾å¼•ç”¨
         * 
         * 2. å¡è¡¨ (Card Table)ï¼š
         *    - å°†æ¯ä¸ªåˆ†åŒºåˆ’åˆ†ä¸ºå¤šä¸ªå¡ç‰‡
         *    - æ ‡è®°åŒ…å«è·¨åˆ†åŒºå¼•ç”¨çš„å¡ç‰‡
         *    - åªæ‰«æè„å¡ç‰‡ï¼Œæé«˜æ•ˆç‡
         * 
         * 3. SATB (Snapshot At The Beginning)ï¼š
         *    - åœ¨å¹¶å‘æ ‡è®°å¼€å§‹æ—¶åˆ›å»ºå¯¹è±¡å›¾å¿«ç…§
         *    - é€šè¿‡å†™å±éšœè®°å½•å¼•ç”¨å˜åŒ–
         *    - ç¡®ä¿å¹¶å‘æ ‡è®°çš„æ­£ç¡®æ€§
         * 
         * 4. åœé¡¿é¢„æµ‹æ¨¡å‹ï¼š
         *    - è®°å½•å†å²GCæ•°æ®
         *    - é¢„æµ‹æ¯ä¸ªåˆ†åŒºçš„å›æ”¶æ—¶é—´
         *    - åœ¨åœé¡¿æ—¶é—´é™åˆ¶å†…é€‰æ‹©æœ€ä¼˜åˆ†åŒºç»„åˆ
         */
    }
}
```

**2. ZGCåƒåœ¾å›æ”¶å™¨**

```java
/**
 * ZGCåƒåœ¾å›æ”¶å™¨å®ç°åˆ†æ
 */
public class ZGarbageCollector {
    
    /**
     * ZGCçš„è®¾è®¡ç›®æ ‡å’Œç‰¹ç‚¹
     */
    public void analyzeZGCDesign() {
        /*
         * ZGCè®¾è®¡ç›®æ ‡ï¼š
         * 
         * 1. è¶…ä½å»¶è¿Ÿï¼š
         *    - åœé¡¿æ—¶é—´<10ms
         *    - ä¸å †å¤§å°æ— å…³çš„åœé¡¿æ—¶é—´
         *    - æ”¯æŒTBçº§åˆ«å †å†…å­˜
         * 
         * 2. ç€è‰²æŒ‡é’ˆæŠ€æœ¯ï¼š
         * â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         * â”‚  64ä½æŒ‡é’ˆå¸ƒå±€ (Linux x86_64)                â”‚
         * â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
         * â”‚ 63  62  61  60  59 ... 18  17 ... 0        â”‚
         * â”‚ â”‚   â”‚   â”‚   â”‚   â”‚        â”‚                 â”‚
         * â”‚ â”‚   â”‚   â”‚   â”‚   â”‚        â””â”€ å¯¹è±¡åœ°å€       â”‚
         * â”‚ â”‚   â”‚   â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ æœªä½¿ç”¨         â”‚
         * â”‚ â”‚   â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Remappedä½    â”‚
         * â”‚ â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Marked1ä½     â”‚
         * â”‚ â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Marked0ä½     â”‚
         * â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Finalizableä½ â”‚
         * â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         * 
         * 3. è¯»å±éšœæŠ€æœ¯ï¼š
         *    - åœ¨è¯»å–å¯¹è±¡å¼•ç”¨æ—¶æ£€æŸ¥æŒ‡é’ˆçŠ¶æ€
         *    - å¦‚æœå¯¹è±¡å·²ç§»åŠ¨ï¼Œè‡ªåŠ¨æ›´æ–°å¼•ç”¨
         *    - ç¡®ä¿åº”ç”¨å§‹ç»ˆè®¿é—®æ­£ç¡®çš„å¯¹è±¡
         */
    }
}
```

## ğŸ’¡ å®æˆ˜æ¡ˆä¾‹ä¸ä»£ç ç¤ºä¾‹

### GCè°ƒä¼˜å®æˆ˜æ¡ˆä¾‹

**åœºæ™¯1ï¼šé«˜å¹¶å‘Webåº”ç”¨GCè°ƒä¼˜**

```java
/**
 * é«˜å¹¶å‘Webåº”ç”¨GCè°ƒä¼˜å®æˆ˜
 */
public class HighConcurrencyWebGCTuning {
    
    /**
     * åº”ç”¨ç‰¹å¾åˆ†æ
     */
    public void analyzeApplicationCharacteristics() {
        /*
         * åº”ç”¨åœºæ™¯ï¼š
         * - é«˜å¹¶å‘Webåº”ç”¨ (QPS > 10000)
         * - å¤§é‡çŸ­ç”Ÿå‘½å‘¨æœŸå¯¹è±¡ (è¯·æ±‚å¯¹è±¡ã€å“åº”å¯¹è±¡)
         * - å¯¹å“åº”æ—¶é—´æ•æ„Ÿ (P99 < 100ms)
         * - 8GBå †å†…å­˜ï¼Œ4æ ¸8çº¿ç¨‹æœåŠ¡å™¨
         * 
         * æ€§èƒ½é—®é¢˜ï¼š
         * - Young GCé¢‘ç¹ï¼Œæ¯ç§’è§¦å‘2-3æ¬¡
         * - Full GCå¶å‘ï¼Œæ¯æ¬¡åœé¡¿500ms+
         * - P99å“åº”æ—¶é—´å¶å°”è¶…è¿‡200ms
         */
    }
    
    /**
     * GCè°ƒä¼˜æ–¹æ¡ˆ
     */
    public void implementGCTuningSolution() {
        /*
         * è°ƒä¼˜å‰é…ç½®ï¼š
         * -Xms8g -Xmx8g
         * -XX:+UseParallelGC (é»˜è®¤)
         * 
         * è°ƒä¼˜åé…ç½®ï¼š
         * # åŸºç¡€å†…å­˜è®¾ç½®
         * -Xms8g -Xmx8g
         * 
         * # ä½¿ç”¨G1åƒåœ¾å›æ”¶å™¨
         * -XX:+UseG1GC
         * -XX:MaxGCPauseMillis=50          # ç›®æ ‡åœé¡¿æ—¶é—´50ms
         * -XX:G1HeapRegionSize=16m         # åˆ†åŒºå¤§å°16MB
         * 
         * # å¹´è½»ä»£è°ƒä¼˜
         * -XX:G1NewSizePercent=30          # å¹´è½»ä»£æœ€å°æ¯”ä¾‹30%
         * -XX:G1MaxNewSizePercent=50       # å¹´è½»ä»£æœ€å¤§æ¯”ä¾‹50%
         * 
         * # å¹¶å‘çº¿ç¨‹è®¾ç½®
         * -XX:ConcGCThreads=2              # å¹¶å‘GCçº¿ç¨‹æ•°
         * -XX:ParallelGCThreads=8          # å¹¶è¡ŒGCçº¿ç¨‹æ•°
         * 
         * è°ƒä¼˜æ•ˆæœï¼š
         * - Young GCé¢‘ç‡ï¼šä»æ¯ç§’3æ¬¡é™åˆ°æ¯ç§’1æ¬¡
         * - GCåœé¡¿æ—¶é—´ï¼šä»å¹³å‡80msé™åˆ°30ms
         * - P99å“åº”æ—¶é—´ï¼šä»200msé™åˆ°80ms
         * - Full GCï¼šåŸºæœ¬æ¶ˆé™¤
         */
    }
    
    /**
     * åº”ç”¨å±‚é¢ä¼˜åŒ–
     */
    public void implementApplicationOptimization() {
        // âœ… ä¼˜åŒ–1ï¼šå¯¹è±¡æ± åŒ–
        private static final ObjectPool<StringBuilder> STRING_BUILDER_POOL = 
            new GenericObjectPool<>(new StringBuilderFactory());
        
        public String processRequest(RequestData request) {
            StringBuilder sb = null;
            try {
                sb = STRING_BUILDER_POOL.borrowObject();
                sb.setLength(0); // é‡ç½®
                
                // ä½¿ç”¨StringBuilderæ„å»ºå“åº”
                sb.append("Response for ").append(request.getId());
                return sb.toString();
            } finally {
                if (sb != null) {
                    STRING_BUILDER_POOL.returnObject(sb);
                }
            }
        }
        
        // âœ… ä¼˜åŒ–2ï¼šç¼“å­˜å¤ç”¨
        private static final ConcurrentHashMap<String, ResponseData> RESPONSE_CACHE = 
            new ConcurrentHashMap<>();
        
        public ResponseData getCachedResponse(String key) {
            return RESPONSE_CACHE.computeIfAbsent(key, k -> {
                // åªæœ‰ç¼“å­˜æœªå‘½ä¸­æ—¶æ‰åˆ›å»ºæ–°å¯¹è±¡
                return createNewResponse(k);
            });
        }
    }
}
```

**åœºæ™¯2ï¼šå¤§æ•°æ®å¤„ç†åº”ç”¨GCè°ƒä¼˜**

```java
/**
 * å¤§æ•°æ®å¤„ç†åº”ç”¨GCè°ƒä¼˜å®æˆ˜
 */
public class BigDataProcessingGCTuning {
    
    /**
     * GCè°ƒä¼˜æ–¹æ¡ˆ
     */
    public void implementGCTuningSolution() {
        /*
         * è°ƒä¼˜é…ç½®ï¼š
         * # åŸºç¡€å†…å­˜è®¾ç½®
         * -Xms32g -Xmx32g
         * 
         * # ä½¿ç”¨ZGC (JDK 17+)
         * -XX:+UseZGC
         * -XX:+UnlockExperimentalVMOptions
         * 
         * # å¤§å¯¹è±¡å¤„ç†
         * -XX:PretenureSizeThreshold=1m    # 1MBä»¥ä¸Šå¯¹è±¡ç›´æ¥è¿›è€å¹´ä»£
         * 
         * # å¹¶å‘è®¾ç½®
         * -XX:ConcGCThreads=8              # å¹¶å‘GCçº¿ç¨‹æ•°
         * -XX:ParallelGCThreads=16         # å¹¶è¡ŒGCçº¿ç¨‹æ•°
         * 
         * # å†…å­˜ç®¡ç†
         * -XX:+UseLargePages               # ä½¿ç”¨å¤§é¡µå†…å­˜
         * -XX:LargePageSizeInBytes=2m      # å¤§é¡µå¤§å°2MB
         * 
         * è°ƒä¼˜æ•ˆæœï¼š
         * - GCåœé¡¿æ—¶é—´ï¼šä»10ç§’é™åˆ°<10ms (ZGC)
         * - ååé‡æå‡ï¼š30%+
         * - å†…å­˜åˆ©ç”¨ç‡ï¼šæå‡20%
         */
    }
    
    /**
     * å†…å­˜ä½¿ç”¨ä¼˜åŒ–
     */
    public void implementMemoryOptimization() {
        // âœ… ä¼˜åŒ–1ï¼šæµå¼å¤„ç†
        public void processLargeDataset(String inputFile) {
            try (Stream<String> lines = Files.lines(Paths.get(inputFile))) {
                lines.parallel()
                     .map(this::parseData)
                     .filter(this::isValidData)
                     .forEach(this::processData);
            } catch (IOException e) {
                logger.error("Error processing file", e);
            }
            // é¿å…ä¸€æ¬¡æ€§åŠ è½½æ‰€æœ‰æ•°æ®åˆ°å†…å­˜
        }
        
        // âœ… ä¼˜åŒ–2ï¼šå †å¤–ç¼“å­˜
        private static final Cache<String, byte[]> OFF_HEAP_CACHE = 
            CacheBuilder.newBuilder()
                .maximumSize(10000)
                .expireAfterWrite(1, TimeUnit.HOURS)
                .build();
        
        public byte[] getCachedData(String key) {
            return OFF_HEAP_CACHE.get(key, this::loadDataFromDisk);
        }
    }
}
```

## ğŸ¯ é¢è¯•é«˜é¢‘é—®é¢˜ç²¾è®²

### æ ¸å¿ƒé¢è¯•é—®é¢˜è§£æ

**é—®é¢˜1ï¼šè¯·è¯¦ç»†å¯¹æ¯”G1ã€CMSã€ZGCä¸‰ç§åƒåœ¾å›æ”¶å™¨çš„ç‰¹ç‚¹å’Œé€‚ç”¨åœºæ™¯**

| å¯¹æ¯”ç»´åº¦ | CMS | G1 | ZGC |
|---------|-----|----|----|
| åœé¡¿æ—¶é—´ | 100-300ms | 10-100ms | <10ms |
| ååé‡ | 90-95% | 85-90% | 85-90% |
| å†…å­˜å¼€é”€ | <5% | 10-15% | 15-20% |
| å †å¤§å°é€‚ç”¨èŒƒå›´ | <32GB | <128GB | æ— é™åˆ¶ |
| å†…å­˜ç¢ç‰‡é—®é¢˜ | ä¸¥é‡ | æ—  | æ—  |

**é€‚ç”¨åœºæ™¯é€‰æ‹©**ï¼š
- **CMS**ï¼šå¯¹å»¶è¿Ÿæ•æ„Ÿä½†å †å†…å­˜ä¸å¤§çš„åº”ç”¨
- **G1**ï¼šéœ€è¦å¹³è¡¡å»¶è¿Ÿå’Œååé‡çš„ä¼ä¸šçº§åº”ç”¨
- **ZGC**ï¼šå¯¹å»¶è¿Ÿæåº¦æ•æ„Ÿçš„å®æ—¶ç³»ç»Ÿ

**é—®é¢˜2ï¼šä»€ä¹ˆæ˜¯ä¸‰è‰²æ ‡è®°ç®—æ³•ï¼Ÿå¦‚ä½•è§£å†³å¹¶å‘æ ‡è®°ä¸­çš„æ¼æ ‡é—®é¢˜ï¼Ÿ**

```java
/**
 * ä¸‰è‰²æ ‡è®°ç®—æ³•è¯¦è§£
 */
public class TriColorMarkingAlgorithm {
    
    /**
     * æ¼æ ‡é—®é¢˜äº§ç”Ÿæ¡ä»¶ï¼š
     * 1. é»‘è‰²å¯¹è±¡æ–°å¢äº†å¯¹ç™½è‰²å¯¹è±¡çš„å¼•ç”¨
     * 2. ç°è‰²å¯¹è±¡åˆ é™¤äº†å¯¹è¯¥ç™½è‰²å¯¹è±¡çš„å¼•ç”¨
     * 
     * è§£å†³æ–¹æ¡ˆï¼š
     * 1. å¢é‡æ›´æ–° (Incremental Update) - CMSä½¿ç”¨
     * 2. åŸå§‹å¿«ç…§ (SATB) - G1ä½¿ç”¨
     */
}
```

**é—®é¢˜3ï¼šG1çš„Mixed GCæ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ**

Mixed GCæ‰§è¡Œè¿‡ç¨‹ï¼š
- **é€‰æ‹©å›æ”¶é›†åˆ**ï¼šæ‰€æœ‰å¹´è½»ä»£åˆ†åŒº + éƒ¨åˆ†è€å¹´ä»£åˆ†åŒº
- **å¹¶è¡Œå›æ”¶**ï¼šä½¿ç”¨å¤åˆ¶ç®—æ³•å›æ”¶é€‰ä¸­çš„åˆ†åŒº
- **ä¼˜å…ˆçº§ç­–ç•¥**ï¼šä¼˜å…ˆå›æ”¶åƒåœ¾æœ€å¤šçš„åˆ†åŒº

**é—®é¢˜4ï¼šZGCçš„ç€è‰²æŒ‡é’ˆæŠ€æœ¯æ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ**

```java
/*
 * ZGCç€è‰²æŒ‡é’ˆ (64ä½)ï¼š
 * â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 * â”‚ 63  62  61  60  59 ... 18  17 ... 0        â”‚
 * â”‚ â”‚   â”‚   â”‚   â”‚   â”‚        â”‚                 â”‚
 * â”‚ â”‚   â”‚   â”‚   â”‚   â”‚        â””â”€ å¯¹è±¡åœ°å€(42ä½) â”‚
 * â”‚ â”‚   â”‚   â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ æœªä½¿ç”¨         â”‚
 * â”‚ â”‚   â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Remappedä½    â”‚
 * â”‚ â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Marked1ä½     â”‚
 * â”‚ â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Marked0ä½     â”‚
 * â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Finalizableä½ â”‚
 * â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
 */
```

**é—®é¢˜5ï¼šå¦‚ä½•è¯Šæ–­å’Œè§£å†³ç”Ÿäº§ç¯å¢ƒçš„GCé—®é¢˜ï¼Ÿ**

è¯Šæ–­æ­¥éª¤ï¼š
- **æ”¶é›†GCæ—¥å¿—**ï¼šä½¿ç”¨`-XX:+PrintGC -XX:+PrintGCDetails`
- **åˆ†æå…³é”®æŒ‡æ ‡**ï¼šGCé¢‘ç‡ã€åœé¡¿æ—¶é—´ã€å†…å­˜ä½¿ç”¨ã€ååé‡
- **ä½¿ç”¨åˆ†æå·¥å…·**ï¼šGCViewerã€Eclipse MATã€jstat
- **è¯†åˆ«é—®é¢˜æ¨¡å¼**ï¼šé¢‘ç¹Young GCã€é•¿æ—¶é—´Full GCã€å†…å­˜æ³„æ¼

## âš¡ æ€§èƒ½ä¼˜åŒ–ä¸æ³¨æ„äº‹é¡¹

### GCè°ƒä¼˜æœ€ä½³å®è·µ

**è°ƒä¼˜åŸåˆ™**ï¼š
- **ä¼˜å…ˆåº”ç”¨å±‚ä¼˜åŒ–**ï¼šå‡å°‘å¯¹è±¡åˆ›å»ºã€å¤ç”¨å¯¹è±¡ã€ä¼˜åŒ–æ•°æ®ç»“æ„
- **é€‰æ‹©åˆé€‚çš„GCç®—æ³•**ï¼šæ ¹æ®å †å¤§å°å’Œå»¶è¿Ÿè¦æ±‚é€‰æ‹©
- **è®¾ç½®åˆç†çš„å †å¤§å°**ï¼šé¿å…åŠ¨æ€æ‰©å±•å¼€é”€
- **æ¸è¿›å¼è°ƒä¼˜**ï¼šä¸€æ¬¡åªè°ƒæ•´ä¸€ä¸ªå‚æ•°

**å¸¸è§è°ƒä¼˜å‚æ•°**ï¼š
```bash
# å†…å­˜è®¾ç½®
-Xms8g -Xmx8g                    # å †å¤§å°
-XX:NewRatio=2                   # è€å¹´ä»£ä¸å¹´è½»ä»£æ¯”ä¾‹

# G1å‚æ•°
-XX:+UseG1GC                     # å¯ç”¨G1
-XX:MaxGCPauseMillis=200         # ç›®æ ‡åœé¡¿æ—¶é—´
-XX:G1HeapRegionSize=16m         # åˆ†åŒºå¤§å°

# ç›‘æ§è®¾ç½®
-XX:+PrintGC                     # æ‰“å°GCä¿¡æ¯
-Xloggc:/var/log/gc.log          # GCæ—¥å¿—æ–‡ä»¶
```

**åº”ç”¨å±‚é¢ä¼˜åŒ–**ï¼š

```java
// âœ… ä¼˜åŒ–1ï¼šå‡å°‘å¯¹è±¡åˆ›å»º
public String goodConcatenation(List<String> items) {
    StringBuilder sb = new StringBuilder();
    for (String item : items) {
        sb.append(item).append(",");
    }
    return sb.toString();
}

// âœ… ä¼˜åŒ–2ï¼šå¯¹è±¡å¤ç”¨
private static final ThreadLocal<DateFormat> DATE_FORMAT = 
    ThreadLocal.withInitial(() -> new SimpleDateFormat("yyyy-MM-dd"));

// âœ… ä¼˜åŒ–3ï¼šåŠæ—¶é‡Šæ”¾å¤§å¯¹è±¡å¼•ç”¨
public void processLargeData() {
    byte[] largeArray = new byte[100 * 1024 * 1024];
    try {
        processArray(largeArray);
    } finally {
        largeArray = null;  // åŠæ—¶é‡Šæ”¾å¼•ç”¨
    }
}
```

## ğŸ“š æ€»ç»“ä¸æŠ€æœ¯å¯¹æ¯”

### åƒåœ¾å›æ”¶å™¨é€‰æ‹©æŒ‡å—

| åº”ç”¨ç±»å‹ | å †å¤§å° | å»¶è¿Ÿè¦æ±‚ | æ¨èGC | ç†ç”± |
|---------|--------|----------|--------|------|
| å°å‹Webåº”ç”¨ | <4GB | ä¸­ç­‰ | Parallel GC | ç®€å•é«˜æ•ˆï¼Œååé‡å¥½ |
| ä¼ä¸šçº§åº”ç”¨ | 4-32GB | è¾ƒé«˜ | G1 GC | å¹³è¡¡å»¶è¿Ÿå’Œååé‡ |
| å¤§æ•°æ®å¤„ç† | 32-128GB | ä¸­ç­‰ | G1 GC | æ”¯æŒå¤§å †ï¼Œå¯é¢„æµ‹åœé¡¿ |
| å®æ—¶ç³»ç»Ÿ | ä»»æ„ | æé«˜ | ZGC | è¶…ä½å»¶è¿Ÿï¼Œ<10msåœé¡¿ |
| é«˜é¢‘äº¤æ˜“ | ä»»æ„ | æé«˜ | ZGC + åº”ç”¨ä¼˜åŒ– | äºšæ¯«ç§’çº§å»¶è¿Ÿ |

### æ ¸å¿ƒæŠ€æœ¯è¦ç‚¹æ€»ç»“

#### ç®—æ³•æ¼”è¿›è·¯å¾„
- æ ‡è®°-æ¸…é™¤ â†’ å¤åˆ¶ç®—æ³• â†’ æ ‡è®°-æ•´ç†
- ä¸²è¡Œ â†’ å¹¶è¡Œ â†’ å¹¶å‘ â†’ ä½å»¶è¿Ÿ
- åˆ†ä»£å‡è®¾ â†’ åˆ†åŒºç®¡ç† â†’ ç€è‰²æŒ‡é’ˆ

**2. æ€§èƒ½ä¼˜åŒ–ç­–ç•¥**ï¼š
- **åº”ç”¨å±‚ä¼˜åŒ–**ï¼šå‡å°‘å¯¹è±¡åˆ›å»ºã€å¤ç”¨å¯¹è±¡ã€ä¼˜åŒ–æ•°æ®ç»“æ„
- **GCå‚æ•°è°ƒä¼˜**ï¼šé€‰æ‹©åˆé€‚çš„æ”¶é›†å™¨ã€è®¾ç½®åˆç†çš„å †å¤§å°å’Œåœé¡¿ç›®æ ‡
- **ç›‘æ§å’Œè¯Šæ–­**ï¼šæ”¶é›†GCæ—¥å¿—ã€åˆ†ææ€§èƒ½æŒ‡æ ‡ã€å®šä½é—®é¢˜æ ¹å› 

**3. æœªæ¥å‘å±•è¶‹åŠ¿**ï¼š
- **æ›´ä½å»¶è¿Ÿ**ï¼šZGCã€Shenandoahç­‰ä½å»¶è¿Ÿæ”¶é›†å™¨æŒç»­ä¼˜åŒ–
- **æ›´å¤§å †æ”¯æŒ**ï¼šæ”¯æŒTBçº§åˆ«å †å†…å­˜çš„ç®¡ç†
- **æ™ºèƒ½åŒ–è°ƒä¼˜**ï¼šè‡ªé€‚åº”å‚æ•°è°ƒæ•´å’Œæ€§èƒ½ä¼˜åŒ–
- **äº‘åŸç”Ÿé€‚é…**ï¼šé€‚åº”å®¹å™¨åŒ–å’Œå¾®æœåŠ¡æ¶æ„

### æœ€ä½³å®è·µå»ºè®®

**å¼€å‘é˜¶æ®µ**ï¼š
- éµå¾ªè‰¯å¥½çš„ç¼–ç¨‹ä¹ æƒ¯ï¼Œå‡å°‘ä¸å¿…è¦çš„å¯¹è±¡åˆ›å»º
- åˆç†ä½¿ç”¨ç¼“å­˜å’Œå¯¹è±¡æ± 
- åŠæ—¶é‡Šæ”¾å¤§å¯¹è±¡å¼•ç”¨

**æµ‹è¯•é˜¶æ®µ**ï¼š
- è¿›è¡Œå‹åŠ›æµ‹è¯•ï¼Œæ¨¡æ‹Ÿç”Ÿäº§ç¯å¢ƒè´Ÿè½½
- æ”¶é›†å’Œåˆ†æGCæ—¥å¿—
- éªŒè¯æ€§èƒ½æŒ‡æ ‡æ˜¯å¦æ»¡è¶³è¦æ±‚

**ç”Ÿäº§é˜¶æ®µ**ï¼š
- æŒç»­ç›‘æ§GCæ€§èƒ½æŒ‡æ ‡
- å»ºç«‹GCé—®é¢˜çš„å‘Šè­¦æœºåˆ¶
- å®šæœŸåˆ†æå’Œä¼˜åŒ–GCé…ç½®

é€šè¿‡æ·±å…¥ç†è§£åƒåœ¾å›æ”¶ç®—æ³•çš„åŸç†å’Œå®ç°ï¼Œç»“åˆå®é™…çš„è°ƒä¼˜ç»éªŒï¼Œæˆ‘ä»¬å¯ä»¥ä¸ºä¸åŒç±»å‹çš„Javaåº”ç”¨é€‰æ‹©æœ€é€‚åˆçš„GCç­–ç•¥ï¼Œå®ç°æ€§èƒ½çš„æœ€å¤§åŒ–ã€‚è®°ä½ï¼ŒGCè°ƒä¼˜æ˜¯ä¸€ä¸ªæŒç»­çš„è¿‡ç¨‹ï¼Œéœ€è¦æ ¹æ®åº”ç”¨çš„å®é™…è¿è¡Œæƒ…å†µä¸æ–­è°ƒæ•´å’Œä¼˜åŒ–ã€‚