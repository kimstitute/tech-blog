---
title: "Redisæ•°æ®ç»“æ„ä¸å†…å­˜ä¼˜åŒ–æ·±åº¦è§£æ"
description: "æ·±å…¥æ¢è®¨Redisäº”å¤§æ•°æ®ç±»å‹çš„åº•å±‚å®ç°åŸç†å’Œå†…å­˜ä¼˜åŒ–ç­–ç•¥ã€‚åˆ†æSDSã€è·³è·ƒè¡¨ã€å‹ç¼©åˆ—è¡¨ç­‰æ ¸å¿ƒæ•°æ®ç»“æ„ï¼ŒæŒæ¡Rediså†…å­˜ç®¡ç†ã€è¿‡æœŸç­–ç•¥å’Œæ€§èƒ½è°ƒä¼˜æŠ€æœ¯ã€‚"
pubDate: 2024-12-28
updatedDate: 2024-12-28
tags: ["redis", "data-structure", "memory-optimization", "sds", "skiplist", "ziplist", "interview"]
categories: ["database"]
subject: "ç¼“å­˜æŠ€æœ¯"
draft: false
featured: true
author: "Gerrad Zhang"
location: "æ­¦æ±‰ï¼Œä¸­å›½"
---

## ğŸ¤” é—®é¢˜èƒŒæ™¯ä¸æŠ€æœ¯æ¼”è¿›

### æˆ‘ä»¬è¦è§£å†³ä»€ä¹ˆé—®é¢˜ï¼Ÿ

åœ¨é«˜å¹¶å‘Webåº”ç”¨ä¸­ï¼Œä¼ ç»Ÿå…³ç³»æ•°æ®åº“é¢ä¸´**æ€§èƒ½ç“¶é¢ˆ**ï¼š

- **æŸ¥è¯¢å»¶è¿Ÿé«˜**ï¼šå¤æ‚SQLæŸ¥è¯¢å“åº”æ—¶é—´è¾¾åˆ°ç§’çº§
- **å¹¶å‘èƒ½åŠ›å·®**ï¼šæ•°æ®åº“è¿æ¥æ•°é™åˆ¶ï¼Œæ— æ³•æ”¯æ’‘é«˜å¹¶å‘
- **çƒ­ç‚¹æ•°æ®è®¿é—®**ï¼šé¢‘ç¹æŸ¥è¯¢ç›¸åŒæ•°æ®é€ æˆæ•°æ®åº“å‹åŠ›
- **æ‰©å±•æ€§å·®**ï¼šå‚ç›´æ‰©å±•æˆæœ¬é«˜ï¼Œæ°´å¹³æ‰©å±•å¤æ‚

```java
// ä¼ ç»Ÿæ•°æ®åº“æŸ¥è¯¢é—®é¢˜ç¤ºä¾‹
public class TraditionalDatabaseIssues {
    
    public UserInfo getUserInfo(Long userId) {
        // æ¯æ¬¡éƒ½éœ€è¦æŸ¥è¯¢æ•°æ®åº“
        String sql = "SELECT * FROM users WHERE id = ?";
        UserInfo user = jdbcTemplate.queryForObject(sql, UserInfo.class, userId);
        
        // æŸ¥è¯¢ç”¨æˆ·çš„è®¢å•ä¿¡æ¯
        String orderSql = "SELECT * FROM orders WHERE user_id = ? ORDER BY create_time DESC LIMIT 10";
        List<Order> orders = jdbcTemplate.query(orderSql, orderMapper, userId);
        
        user.setRecentOrders(orders);
        return user;
        // æ¯æ¬¡æŸ¥è¯¢éƒ½éœ€è¦ç£ç›˜IOï¼Œå“åº”æ—¶é—´100ms+
    }
}
```

### æ²¡æœ‰è¿™ä¸ªæŠ€æœ¯æ—¶æ˜¯æ€ä¹ˆåšçš„ï¼Ÿ

åœ¨Rediså‡ºç°ä¹‹å‰ï¼Œå¼€å‘è€…ä¸»è¦é€šè¿‡ä»¥ä¸‹æ–¹å¼æå‡æ€§èƒ½ï¼š

**1. åº”ç”¨å±‚ç¼“å­˜**
- ä½¿ç”¨HashMapã€ConcurrentHashMapç­‰å†…å­˜ç»“æ„
- **é—®é¢˜**ï¼šé‡å¯ä¸¢å¤±æ•°æ®ï¼Œæ— æ³•è·¨è¿›ç¨‹å…±äº«

**2. æ–‡ä»¶ç¼“å­˜**
- å°†æŸ¥è¯¢ç»“æœåºåˆ—åŒ–åˆ°æ–‡ä»¶
- **é—®é¢˜**ï¼šIOå¼€é”€å¤§ï¼Œå¹¶å‘æ§åˆ¶å¤æ‚

**3. æ•°æ®åº“æŸ¥è¯¢ä¼˜åŒ–**
- æ·»åŠ ç´¢å¼•ã€ä¼˜åŒ–SQLè¯­å¥
- **é—®é¢˜**ï¼šæ²»æ ‡ä¸æ²»æœ¬ï¼Œä»æœ‰ç£ç›˜IOç“¶é¢ˆ

**4. åˆ†å¸ƒå¼ç¼“å­˜æ–¹æ¡ˆ**
- Memcachedç­‰æ—©æœŸç¼“å­˜ç³»ç»Ÿ
- **é—®é¢˜**ï¼šæ•°æ®ç»“æ„å•ä¸€ï¼ŒåŠŸèƒ½æœ‰é™

### æŠ€æœ¯æ¼”è¿›çš„å†å²è„‰ç»œ

**2009å¹´**: Redisè¯ç”Ÿ
- Salvatore Sanfilippoåˆ›å»ºRedisé¡¹ç›®
- æœ€åˆä¸ºè§£å†³ç½‘ç«™å®æ—¶ç»Ÿè®¡é—®é¢˜

**2010-2012å¹´**: æ ¸å¿ƒåŠŸèƒ½å®Œå–„
- äº”å¤§æ•°æ®ç±»å‹ç¡®ç«‹
- æŒä¹…åŒ–æœºåˆ¶ï¼ˆRDBã€AOFï¼‰å®ç°
- ä¸»ä»å¤åˆ¶åŠŸèƒ½

**2013-2015å¹´**: é«˜å¯ç”¨å‘å±•
- Redis Sentinelå“¨å…µæ¨¡å¼
- Redis Clusteré›†ç¾¤æ–¹æ¡ˆ
- Luaè„šæœ¬æ”¯æŒ

**2016å¹´è‡³ä»Š**: æ€§èƒ½ä¸åŠŸèƒ½ä¼˜åŒ–
- å†…å­˜ä¼˜åŒ–ç®—æ³•æ”¹è¿›
- æ–°æ•°æ®ç±»å‹ï¼ˆStreamã€Bitmapç­‰ï¼‰
- Redis 6.0å¤šçº¿ç¨‹æ”¯æŒ

## ğŸ¯ æ ¸å¿ƒæ¦‚å¿µä¸åŸç†

### Redisäº”å¤§æ•°æ®ç±»å‹

**Redisæ ¸å¿ƒæ•°æ®ç±»å‹åŠå…¶åº”ç”¨åœºæ™¯**ï¼š

```java
/**
 * Redisæ•°æ®ç±»å‹åº”ç”¨åˆ†æ
 */
public class RedisDataTypes {
    
    /**
     * Stringç±»å‹åº”ç”¨
     */
    public void analyzeStringType() {
        /*
         * Stringç±»å‹ç‰¹ç‚¹ï¼š
         * - æœ€åŸºç¡€çš„æ•°æ®ç±»å‹
         * - å¯ä»¥å­˜å‚¨å­—ç¬¦ä¸²ã€æ•°å­—ã€äºŒè¿›åˆ¶æ•°æ®
         * - æœ€å¤§512MB
         * 
         * åº•å±‚å®ç°ï¼šSDSï¼ˆSimple Dynamic Stringï¼‰
         * 
         * åº”ç”¨åœºæ™¯ï¼š
         * 1. ç¼“å­˜ç”¨æˆ·ä¿¡æ¯
         * 2. åˆ†å¸ƒå¼é”
         * 3. è®¡æ•°å™¨
         * 4. é™æµæ§åˆ¶
         * 
         * å¸¸ç”¨å‘½ä»¤ï¼š
         * SET user:1001 "{\"name\":\"Alice\",\"age\":25}"
         * GET user:1001
         * INCR page_views
         * SETEX session:abc123 3600 "user_data"
         */
    }
    
    /**
     * Hashç±»å‹åº”ç”¨
     */
    public void analyzeHashType() {
        /*
         * Hashç±»å‹ç‰¹ç‚¹ï¼š
         * - é”®å€¼å¯¹é›†åˆï¼Œç±»ä¼¼Javaçš„HashMap
         * - é€‚åˆå­˜å‚¨å¯¹è±¡
         * - èŠ‚çœå†…å­˜ç©ºé—´
         * 
         * åº•å±‚å®ç°ï¼š
         * - å°æ•°æ®é‡ï¼šziplistï¼ˆå‹ç¼©åˆ—è¡¨ï¼‰
         * - å¤§æ•°æ®é‡ï¼šhashtableï¼ˆå“ˆå¸Œè¡¨ï¼‰
         * 
         * åº”ç”¨åœºæ™¯ï¼š
         * 1. ç”¨æˆ·ä¿¡æ¯å­˜å‚¨
         * 2. å•†å“å±æ€§å­˜å‚¨
         * 3. é…ç½®ä¿¡æ¯ç®¡ç†
         * 
         * å¸¸ç”¨å‘½ä»¤ï¼š
         * HSET user:1001 name "Alice" age 25 email "alice@example.com"
         * HGET user:1001 name
         * HMGET user:1001 name age
         * HINCRBY user:1001 age 1
         */
    }
    
    /**
     * Listç±»å‹åº”ç”¨
     */
    public void analyzeListType() {
        /*
         * Listç±»å‹ç‰¹ç‚¹ï¼š
         * - æœ‰åºçš„å­—ç¬¦ä¸²åˆ—è¡¨
         * - æ”¯æŒä¸¤ç«¯æ’å…¥å’Œå¼¹å‡º
         * - å¯ä»¥ä½œä¸ºæ ˆæˆ–é˜Ÿåˆ—ä½¿ç”¨
         * 
         * åº•å±‚å®ç°ï¼š
         * - Redis 3.2ä¹‹å‰ï¼šziplist + linkedlist
         * - Redis 3.2ä¹‹åï¼šquicklistï¼ˆå¿«é€Ÿåˆ—è¡¨ï¼‰
         * 
         * åº”ç”¨åœºæ™¯ï¼š
         * 1. æ¶ˆæ¯é˜Ÿåˆ—
         * 2. æœ€æ–°åŠ¨æ€åˆ—è¡¨
         * 3. æ’è¡Œæ¦œ
         * 4. ä»»åŠ¡é˜Ÿåˆ—
         * 
         * å¸¸ç”¨å‘½ä»¤ï¼š
         * LPUSH news:latest "æ–°é—»1" "æ–°é—»2"
         * RPOP news:latest
         * LRANGE news:latest 0 9
         * BLPOP task_queue 30
         */
    }
    
    /**
     * Setç±»å‹åº”ç”¨
     */
    public void analyzeSetType() {
        /*
         * Setç±»å‹ç‰¹ç‚¹ï¼š
         * - æ— åºçš„å­—ç¬¦ä¸²é›†åˆ
         * - å…ƒç´ å”¯ä¸€æ€§
         * - æ”¯æŒé›†åˆè¿ç®—
         * 
         * åº•å±‚å®ç°ï¼š
         * - å°æ•°æ®é‡ï¼šintsetï¼ˆæ•´æ•°é›†åˆï¼‰
         * - å¤§æ•°æ®é‡ï¼šhashtableï¼ˆå“ˆå¸Œè¡¨ï¼‰
         * 
         * åº”ç”¨åœºæ™¯ï¼š
         * 1. æ ‡ç­¾ç³»ç»Ÿ
         * 2. å¥½å‹å…³ç³»
         * 3. æƒé™ç®¡ç†
         * 4. å»é‡ç»Ÿè®¡
         * 
         * å¸¸ç”¨å‘½ä»¤ï¼š
         * SADD user:1001:tags "Java" "Redis" "MySQL"
         * SISMEMBER user:1001:tags "Java"
         * SINTER user:1001:tags user:1002:tags
         * SCARD user:1001:tags
         */
    }
    
    /**
     * ZSetç±»å‹åº”ç”¨
     */
    public void analyzeZSetType() {
        /*
         * ZSetç±»å‹ç‰¹ç‚¹ï¼š
         * - æœ‰åºçš„å­—ç¬¦ä¸²é›†åˆ
         * - æ¯ä¸ªå…ƒç´ å…³è”ä¸€ä¸ªåˆ†æ•°
         * - æŒ‰åˆ†æ•°æ’åº
         * 
         * åº•å±‚å®ç°ï¼š
         * - å°æ•°æ®é‡ï¼šziplistï¼ˆå‹ç¼©åˆ—è¡¨ï¼‰
         * - å¤§æ•°æ®é‡ï¼šskiplistï¼ˆè·³è·ƒè¡¨ï¼‰+ hashtable
         * 
         * åº”ç”¨åœºæ™¯ï¼š
         * 1. æ’è¡Œæ¦œ
         * 2. å»¶æ—¶é˜Ÿåˆ—
         * 3. èŒƒå›´æŸ¥è¯¢
         * 4. æƒé‡æ’åº
         * 
         * å¸¸ç”¨å‘½ä»¤ï¼š
         * ZADD leaderboard 1000 "player1" 1500 "player2"
         * ZRANGE leaderboard 0 9 WITHSCORES
         * ZREVRANK leaderboard "player1"
         * ZINCRBY leaderboard 100 "player1"
         */
    }
}
```

### åº•å±‚æ•°æ®ç»“æ„å®ç°

**Redisæ ¸å¿ƒæ•°æ®ç»“æ„åˆ†æ**ï¼š

```java
/**
 * Redisåº•å±‚æ•°æ®ç»“æ„åˆ†æ
 */
public class RedisDataStructures {
    
    /**
     * SDSï¼ˆSimple Dynamic Stringï¼‰åˆ†æ
     */
    public void analyzeSDSStructure() {
        /*
         * SDSç»“æ„å®šä¹‰ï¼ˆRedis 3.2+ï¼‰ï¼š
         * 
         * struct sdshdr8 {
         *     uint8_t len;        // å·²ä½¿ç”¨é•¿åº¦
         *     uint8_t alloc;      // æ€»åˆ†é…é•¿åº¦
         *     unsigned char flags; // æ ‡å¿—ä½
         *     char buf[];         // å­—ç¬¦æ•°ç»„
         * };
         * 
         * SDSä¼˜åŠ¿ï¼š
         * 1. O(1)è·å–å­—ç¬¦ä¸²é•¿åº¦
         * 2. é˜²æ­¢ç¼“å†²åŒºæº¢å‡º
         * 3. å‡å°‘å†…å­˜é‡åˆ†é…æ¬¡æ•°
         * 4. äºŒè¿›åˆ¶å®‰å…¨
         * 
         * å†…å­˜é¢„åˆ†é…ç­–ç•¥ï¼š
         * - å¦‚æœlen < 1MBï¼šæ–°åˆ†é…ç©ºé—´ = len * 2 + 1
         * - å¦‚æœlen >= 1MBï¼šæ–°åˆ†é…ç©ºé—´ = len + 1MB + 1
         * 
         * æƒ°æ€§ç©ºé—´é‡Šæ”¾ï¼š
         * - ç¼©çŸ­å­—ç¬¦ä¸²æ—¶ä¸ç«‹å³é‡Šæ”¾å†…å­˜
         * - ä¿ç•™ç©ºé—´ä¾›ä¸‹æ¬¡ä½¿ç”¨
         */
    }
    
    /**
     * è·³è·ƒè¡¨ï¼ˆSkip Listï¼‰åˆ†æ
     */
    public void analyzeSkipListStructure() {
        /*
         * è·³è·ƒè¡¨ç‰¹ç‚¹ï¼š
         * - æœ‰åºæ•°æ®ç»“æ„
         * - å¹³å‡O(logN)æŸ¥æ‰¾å¤æ‚åº¦
         * - å®ç°ç®€å•ï¼Œæ— éœ€æ—‹è½¬æ“ä½œ
         * 
         * èŠ‚ç‚¹ç»“æ„ï¼š
         * typedef struct zskiplistNode {
         *     sds ele;                    // æˆå‘˜å¯¹è±¡
         *     double score;               // åˆ†å€¼
         *     struct zskiplistNode *backward; // åé€€æŒ‡é’ˆ
         *     struct zskiplistLevel {
         *         struct zskiplistNode *forward; // å‰è¿›æŒ‡é’ˆ
         *         unsigned int span;             // è·¨åº¦
         *     } level[];                  // å±‚çº§æ•°ç»„
         * } zskiplistNode;
         * 
         * å±‚çº§ç”Ÿæˆç®—æ³•ï¼š
         * - æ¯ä¸ªèŠ‚ç‚¹è‡³å°‘æœ‰1å±‚
         * - æ¯å¢åŠ ä¸€å±‚çš„æ¦‚ç‡æ˜¯1/4
         * - æœ€å¤§å±‚æ•°é™åˆ¶ä¸º32
         * 
         * æŸ¥æ‰¾è¿‡ç¨‹ï¼š
         * 1. ä»æœ€é«˜å±‚å¼€å§‹
         * 2. å‘å‰æŸ¥æ‰¾ç›´åˆ°ä¸‹ä¸€ä¸ªèŠ‚ç‚¹åˆ†å€¼å¤§äºç›®æ ‡
         * 3. ä¸‹é™åˆ°ä¸‹ä¸€å±‚ç»§ç»­æŸ¥æ‰¾
         * 4. é‡å¤ç›´åˆ°æ‰¾åˆ°ç›®æ ‡æˆ–åˆ°è¾¾åº•å±‚
         */
    }
    
    /**
     * å‹ç¼©åˆ—è¡¨ï¼ˆZip Listï¼‰åˆ†æ
     */
    public void analyzeZipListStructure() {
        /*
         * å‹ç¼©åˆ—è¡¨ç‰¹ç‚¹ï¼š
         * - ç´§å‡‘çš„å†…å­˜å¸ƒå±€
         * - èŠ‚çœå†…å­˜ç©ºé—´
         * - é¡ºåºè®¿é—®æ€§èƒ½å¥½
         * 
         * æ•´ä½“ç»“æ„ï¼š
         * | zlbytes | zltail | zllen | entry1 | entry2 | ... | zlend |
         * 
         * å­—æ®µè¯´æ˜ï¼š
         * - zlbytesï¼šæ•´ä¸ªå‹ç¼©åˆ—è¡¨å ç”¨å­—èŠ‚æ•°
         * - zltailï¼šå°¾èŠ‚ç‚¹åç§»é‡
         * - zllenï¼šèŠ‚ç‚¹æ•°é‡
         * - entryï¼šæ•°æ®èŠ‚ç‚¹
         * - zlendï¼šç»“æŸæ ‡å¿—ï¼ˆ0xFFï¼‰
         * 
         * èŠ‚ç‚¹ç»“æ„ï¼š
         * | prevlen | encoding | data |
         * 
         * - prevlenï¼šå‰ä¸€ä¸ªèŠ‚ç‚¹é•¿åº¦
         * - encodingï¼šç¼–ç ç±»å‹å’Œé•¿åº¦
         * - dataï¼šå®é™…æ•°æ®
         * 
         * ç¼ºç‚¹ï¼š
         * - è¿é”æ›´æ–°é—®é¢˜
         * - éšæœºè®¿é—®æ€§èƒ½å·®
         * - æ’å…¥åˆ é™¤å¯èƒ½éœ€è¦å†…å­˜é‡åˆ†é…
         */
    }
    
    /**
     * å¿«é€Ÿåˆ—è¡¨ï¼ˆQuick Listï¼‰åˆ†æ
     */
    public void analyzeQuickListStructure() {
        /*
         * å¿«é€Ÿåˆ—è¡¨ç‰¹ç‚¹ï¼š
         * - åŒå‘é“¾è¡¨ + å‹ç¼©åˆ—è¡¨çš„ç»“åˆ
         * - å¹³è¡¡å†…å­˜ä½¿ç”¨å’Œæ€§èƒ½
         * - Redis 3.2åListç±»å‹çš„åº•å±‚å®ç°
         * 
         * ç»“æ„ç»„æˆï¼š
         * typedef struct quicklist {
         *     quicklistNode *head;    // å¤´èŠ‚ç‚¹
         *     quicklistNode *tail;    // å°¾èŠ‚ç‚¹
         *     unsigned long count;    // æ€»å…ƒç´ æ•°é‡
         *     unsigned long len;      // èŠ‚ç‚¹æ•°é‡
         *     int fill : 16;          // å¡«å……å› å­
         *     unsigned int compress : 16; // å‹ç¼©æ·±åº¦
         * } quicklist;
         * 
         * èŠ‚ç‚¹ç»“æ„ï¼š
         * typedef struct quicklistNode {
         *     struct quicklistNode *prev; // å‰é©±èŠ‚ç‚¹
         *     struct quicklistNode *next; // åç»§èŠ‚ç‚¹
         *     unsigned char *zl;          // å‹ç¼©åˆ—è¡¨
         *     unsigned int sz;            // å‹ç¼©åˆ—è¡¨å­—èŠ‚æ•°
         *     unsigned int count : 16;    // å…ƒç´ æ•°é‡
         *     unsigned int encoding : 2;  // ç¼–ç æ ¼å¼
         *     unsigned int container : 2; // å®¹å™¨ç±»å‹
         *     unsigned int recompress : 1; // æ˜¯å¦éœ€è¦é‡æ–°å‹ç¼©
         * } quicklistNode;
         * 
         * ä¼˜åŒ–ç­–ç•¥ï¼š
         * 1. æ§åˆ¶æ¯ä¸ªèŠ‚ç‚¹çš„å…ƒç´ æ•°é‡
         * 2. ä¸­é—´èŠ‚ç‚¹å¯ä»¥å‹ç¼©å­˜å‚¨
         * 3. ä¸¤ç«¯èŠ‚ç‚¹ä¿æŒæœªå‹ç¼©çŠ¶æ€
         */
    }
}
```

## ğŸ”§ å®ç°åŸç†ä¸æºç åˆ†æ

### å†…å­˜ç¼–ç ä¼˜åŒ–

**Redisé’ˆå¯¹ä¸åŒåœºæ™¯çš„å†…å­˜ä¼˜åŒ–ç­–ç•¥**ï¼š

```java
/**
 * Rediså†…å­˜ç¼–ç ä¼˜åŒ–åˆ†æ
 */
public class RedisMemoryOptimization {
    
    /**
     * Hashç±»å‹ç¼–ç è½¬æ¢
     */
    public void analyzeHashEncoding() {
        /*
         * Hashç¼–ç è½¬æ¢æ¡ä»¶ï¼š
         * 
         * 1. ziplistç¼–ç æ¡ä»¶ï¼ˆåŒæ—¶æ»¡è¶³ï¼‰ï¼š
         *    - å“ˆå¸Œå¯¹è±¡ä¿å­˜çš„æ‰€æœ‰é”®å€¼å¯¹çš„é”®å’Œå€¼çš„å­—ç¬¦ä¸²é•¿åº¦éƒ½å°äº64å­—èŠ‚
         *    - å“ˆå¸Œå¯¹è±¡ä¿å­˜çš„é”®å€¼å¯¹æ•°é‡å°äº512ä¸ª
         * 
         * 2. hashtableç¼–ç ï¼š
         *    - ä¸æ»¡è¶³ziplistæ¡ä»¶æ—¶ä½¿ç”¨
         * 
         * é…ç½®å‚æ•°ï¼š
         * hash-max-ziplist-entries 512
         * hash-max-ziplist-value 64
         * 
         * å†…å­˜å¯¹æ¯”ç¤ºä¾‹ï¼š
         * 
         * å­˜å‚¨100ä¸ªç”¨æˆ·ä¿¡æ¯ï¼š
         * - ziplistç¼–ç ï¼šçº¦å ç”¨å†…å­˜ 50KB
         * - hashtableç¼–ç ï¼šçº¦å ç”¨å†…å­˜ 200KB
         * 
         * ziplistä¼˜åŠ¿ï¼š
         * - å†…å­˜ç´§å‡‘ï¼Œå‡å°‘å†…å­˜ç¢ç‰‡
         * - ç¼“å­˜å‹å¥½ï¼Œæé«˜è®¿é—®å±€éƒ¨æ€§
         * 
         * hashtableä¼˜åŠ¿ï¼š
         * - O(1)å¹³å‡æŸ¥æ‰¾æ—¶é—´
         * - æ”¯æŒå¤§æ•°æ®é‡
         */
    }
    
    /**
     * Listç±»å‹ä¼˜åŒ–ç­–ç•¥
     */
    public void analyzeListOptimization() {
        /*
         * QuickListé…ç½®å‚æ•°ï¼š
         * 
         * list-max-ziplist-size -2
         * å«ä¹‰ï¼š
         * - æ­£æ•°ï¼šæ¯ä¸ªèŠ‚ç‚¹æœ€å¤šåŒ…å«çš„å…ƒç´ æ•°é‡
         * - è´Ÿæ•°ï¼šæ¯ä¸ªèŠ‚ç‚¹æœ€å¤§å†…å­˜å¤§å°
         *   -1: 4KB, -2: 8KB, -3: 16KB, -4: 32KB, -5: 64KB
         * 
         * list-compress-depth 0
         * å«ä¹‰ï¼š
         * - 0ï¼šä¸å‹ç¼©
         * - 1ï¼šé™¤äº†é¦–å°¾èŠ‚ç‚¹ï¼Œå…¶ä»–èŠ‚ç‚¹å‹ç¼©
         * - 2ï¼šé™¤äº†é¦–å°¾å„2ä¸ªèŠ‚ç‚¹ï¼Œå…¶ä»–èŠ‚ç‚¹å‹ç¼©
         * 
         * å‹ç¼©æ•ˆæœï¼š
         * - æœªå‹ç¼©ï¼š100MBæ•°æ®å ç”¨100MBå†…å­˜
         * - LZFå‹ç¼©ï¼š100MBæ•°æ®å ç”¨çº¦60MBå†…å­˜
         * 
         * æ€§èƒ½æƒè¡¡ï¼š
         * - å‹ç¼©èŠ‚çœå†…å­˜ä½†å¢åŠ CPUå¼€é”€
         * - é€‚åˆå†…å­˜æ•æ„Ÿã€è®¿é—®é¢‘ç‡ä½çš„åœºæ™¯
         */
    }
    
    /**
     * Setç±»å‹ç¼–ç ä¼˜åŒ–
     */
    public void analyzeSetOptimization() {
        /*
         * Setç¼–ç è½¬æ¢æ¡ä»¶ï¼š
         * 
         * 1. intsetç¼–ç æ¡ä»¶ï¼ˆåŒæ—¶æ»¡è¶³ï¼‰ï¼š
         *    - é›†åˆå¯¹è±¡ä¿å­˜çš„æ‰€æœ‰å…ƒç´ éƒ½æ˜¯æ•´æ•°å€¼
         *    - é›†åˆå¯¹è±¡ä¿å­˜çš„å…ƒç´ æ•°é‡ä¸è¶…è¿‡512ä¸ª
         * 
         * 2. hashtableç¼–ç ï¼š
         *    - ä¸æ»¡è¶³intsetæ¡ä»¶æ—¶ä½¿ç”¨
         * 
         * é…ç½®å‚æ•°ï¼š
         * set-max-intset-entries 512
         * 
         * intsetä¼˜åŠ¿ï¼š
         * - å†…å­˜å ç”¨æå°‘
         * - æœ‰åºå­˜å‚¨ï¼Œæ”¯æŒäºŒåˆ†æŸ¥æ‰¾
         * 
         * ç¤ºä¾‹å¯¹æ¯”ï¼š
         * å­˜å‚¨1000ä¸ªæ•´æ•°IDï¼š
         * - intsetï¼šçº¦4KBå†…å­˜
         * - hashtableï¼šçº¦40KBå†…å­˜
         * 
         * ä½¿ç”¨å»ºè®®ï¼š
         * - çº¯æ•´æ•°é›†åˆä¼˜å…ˆä½¿ç”¨intset
         * - æ··åˆç±»å‹æˆ–å¤§é›†åˆä½¿ç”¨hashtable
         */
    }
    
    /**
     * ZSetç±»å‹ç¼–ç ä¼˜åŒ–
     */
    public void analyzeZSetOptimization() {
        /*
         * ZSetç¼–ç è½¬æ¢æ¡ä»¶ï¼š
         * 
         * 1. ziplistç¼–ç æ¡ä»¶ï¼ˆåŒæ—¶æ»¡è¶³ï¼‰ï¼š
         *    - æœ‰åºé›†åˆä¿å­˜çš„å…ƒç´ æ•°é‡å°äº128ä¸ª
         *    - æœ‰åºé›†åˆä¿å­˜çš„æ‰€æœ‰å…ƒç´ æˆå‘˜çš„é•¿åº¦éƒ½å°äº64å­—èŠ‚
         * 
         * 2. skiplistç¼–ç ï¼š
         *    - ä¸æ»¡è¶³ziplistæ¡ä»¶æ—¶ä½¿ç”¨
         * 
         * é…ç½®å‚æ•°ï¼š
         * zset-max-ziplist-entries 128
         * zset-max-ziplist-value 64
         * 
         * å†…å­˜ä½¿ç”¨å¯¹æ¯”ï¼š
         * å­˜å‚¨100ä¸ªæ’è¡Œæ¦œæ•°æ®ï¼š
         * - ziplistï¼šçº¦10KBå†…å­˜
         * - skiplistï¼šçº¦50KBå†…å­˜
         * 
         * æ€§èƒ½å¯¹æ¯”ï¼š
         * - ziplistï¼šèŒƒå›´æŸ¥è¯¢O(N)ï¼Œé€‚åˆå°æ•°æ®é‡
         * - skiplistï¼šèŒƒå›´æŸ¥è¯¢O(logN)ï¼Œé€‚åˆå¤§æ•°æ®é‡
         */
    }
}
```

## ğŸ’¡ å®æˆ˜æ¡ˆä¾‹ä¸ä»£ç ç¤ºä¾‹

### ç”µå•†ç³»ç»ŸRedisä¼˜åŒ–å®æˆ˜

```java
/**
 * ç”µå•†ç³»ç»ŸRedisä¼˜åŒ–å®æˆ˜
 */
public class EcommerceRedisOptimization {
    
    /**
     * å•†å“ä¿¡æ¯ç¼“å­˜ä¼˜åŒ–
     */
    public void optimizeProductCache() {
        /*
         * åœºæ™¯ï¼šå•†å“è¯¦æƒ…é¡µç¼“å­˜
         * åŸå§‹æ–¹æ¡ˆï¼šStringç±»å‹å­˜å‚¨JSON
         */
        
        // âŒ ä½æ•ˆæ–¹æ¡ˆï¼šStringå­˜å‚¨å®Œæ•´JSON
        String productJson = "{\"id\":1001,\"name\":\"iPhone\",\"price\":5999,\"stock\":100,\"category\":\"æ‰‹æœº\"}";
        redisTemplate.opsForValue().set("product:1001", productJson, 3600, TimeUnit.SECONDS);
        
        // âœ… ä¼˜åŒ–æ–¹æ¡ˆï¼šHashç±»å‹å­˜å‚¨
        Map<String, String> productInfo = new HashMap<>();
        productInfo.put("name", "iPhone");
        productInfo.put("price", "5999");
        productInfo.put("stock", "100");
        productInfo.put("category", "æ‰‹æœº");
        redisTemplate.opsForHash().putAll("product:1001", productInfo);
        redisTemplate.expire("product:1001", 3600, TimeUnit.SECONDS);
        
        /*
         * ä¼˜åŒ–æ•ˆæœï¼š
         * - å†…å­˜èŠ‚çœï¼šHashæ¯”StringèŠ‚çœ20-30%å†…å­˜
         * - æ›´æ–°çµæ´»ï¼šå¯ä»¥å•ç‹¬æ›´æ–°æŸä¸ªå­—æ®µ
         * - æŸ¥è¯¢é«˜æ•ˆï¼šå¯ä»¥è·å–æŒ‡å®šå­—æ®µ
         * 
         * ä½¿ç”¨åœºæ™¯ï¼š
         * - å­—æ®µè¾ƒå¤šçš„å¯¹è±¡å­˜å‚¨
         * - éœ€è¦é¢‘ç¹æ›´æ–°éƒ¨åˆ†å­—æ®µ
         * - å†…å­˜æ•æ„Ÿçš„åº”ç”¨
         */
    }
    
    /**
     * ç”¨æˆ·ä¼šè¯ä¼˜åŒ–
     */
    public void optimizeUserSession() {
        /*
         * åœºæ™¯ï¼šç”¨æˆ·ä¼šè¯ä¿¡æ¯å­˜å‚¨
         */
        
        // âŒ åŸå§‹æ–¹æ¡ˆï¼šæ¯ä¸ªå±æ€§å•ç‹¬å­˜å‚¨
        redisTemplate.opsForValue().set("session:user_id:" + sessionId, userId, 1800, TimeUnit.SECONDS);
        redisTemplate.opsForValue().set("session:username:" + sessionId, username, 1800, TimeUnit.SECONDS);
        redisTemplate.opsForValue().set("session:role:" + sessionId, role, 1800, TimeUnit.SECONDS);
        redisTemplate.opsForValue().set("session:login_time:" + sessionId, loginTime, 1800, TimeUnit.SECONDS);
        
        // âœ… ä¼˜åŒ–æ–¹æ¡ˆï¼šHashå­˜å‚¨ä¼šè¯ä¿¡æ¯
        Map<String, String> sessionData = new HashMap<>();
        sessionData.put("user_id", userId);
        sessionData.put("username", username);
        sessionData.put("role", role);
        sessionData.put("login_time", loginTime);
        sessionData.put("last_access", String.valueOf(System.currentTimeMillis()));
        
        redisTemplate.opsForHash().putAll("session:" + sessionId, sessionData);
        redisTemplate.expire("session:" + sessionId, 1800, TimeUnit.SECONDS);
        
        /*
         * ä¼˜åŒ–æ•ˆæœï¼š
         * - å‡å°‘Keyæ•°é‡ï¼šä»4ä¸ªKeyå‡å°‘åˆ°1ä¸ªKey
         * - åŸå­æ“ä½œï¼šä¸€æ¬¡æ€§è·å–æ‰€æœ‰ä¼šè¯ä¿¡æ¯
         * - å†…å­˜èŠ‚çœï¼šå‡å°‘Keyçš„å­˜å‚¨å¼€é”€
         * - ç®¡ç†ç®€åŒ–ï¼šç»Ÿä¸€çš„è¿‡æœŸæ—¶é—´ç®¡ç†
         */
    }
    
    /**
     * æ’è¡Œæ¦œç³»ç»Ÿä¼˜åŒ–
     */
    public void optimizeLeaderboard() {
        /*
         * åœºæ™¯ï¼šæ¸¸æˆç§¯åˆ†æ’è¡Œæ¦œ
         */
        
        // å®æ—¶æ›´æ–°ç”¨æˆ·ç§¯åˆ†
        public void updateUserScore(String userId, double score) {
            // æ›´æ–°æ€»æ’è¡Œæ¦œ
            redisTemplate.opsForZSet().add("leaderboard:global", userId, score);
            
            // æ›´æ–°æ¯æ—¥æ’è¡Œæ¦œ
            String dailyKey = "leaderboard:daily:" + LocalDate.now().format(DateTimeFormatter.ofPattern("yyyyMMdd"));
            redisTemplate.opsForZSet().add(dailyKey, userId, score);
            redisTemplate.expire(dailyKey, 7, TimeUnit.DAYS);
            
            // æ›´æ–°ç”¨æˆ·æ‰€åœ¨åŒºåŸŸæ’è¡Œæ¦œ
            String region = getUserRegion(userId);
            String regionKey = "leaderboard:region:" + region;
            redisTemplate.opsForZSet().add(regionKey, userId, score);
        }
        
        // è·å–æ’è¡Œæ¦œæ•°æ®
        public List<LeaderboardEntry> getTopPlayers(int limit) {
            Set<ZSetOperations.TypedTuple<String>> tuples = 
                redisTemplate.opsForZSet().reverseRangeWithScores("leaderboard:global", 0, limit - 1);
            
            return tuples.stream()
                .map(tuple -> new LeaderboardEntry(tuple.getValue(), tuple.getScore()))
                .collect(Collectors.toList());
        }
        
        // è·å–ç”¨æˆ·æ’å
        public Long getUserRank(String userId) {
            return redisTemplate.opsForZSet().reverseRank("leaderboard:global", userId);
        }
        
        /*
         * ä¼˜åŒ–ç­–ç•¥ï¼š
         * 1. åˆ†å±‚æ’è¡Œæ¦œï¼šå…¨çƒã€åŒºåŸŸã€æ¯æ—¥
         * 2. åˆç†è®¾ç½®è¿‡æœŸæ—¶é—´
         * 3. ä½¿ç”¨ZSetçš„æœ‰åºç‰¹æ€§
         * 4. æ‰¹é‡æ“ä½œå‡å°‘ç½‘ç»œå¼€é”€
         */
    }
    
    /**
     * ç¼“å­˜ç©¿é€é˜²æŠ¤
     */
    public void preventCachePenetration() {
        /*
         * åœºæ™¯ï¼šé˜²æ­¢ç¼“å­˜ç©¿é€æ”»å‡»
         */
        
        public ProductInfo getProduct(Long productId) {
            // 1. å…ˆæŸ¥Redisç¼“å­˜
            String cacheKey = "product:" + productId;
            String cached = redisTemplate.opsForValue().get(cacheKey);
            
            if (cached != null) {
                if ("NULL".equals(cached)) {
                    // ç©ºå€¼ç¼“å­˜ï¼Œç›´æ¥è¿”å›null
                    return null;
                }
                return JSON.parseObject(cached, ProductInfo.class);
            }
            
            // 2. æŸ¥è¯¢æ•°æ®åº“
            ProductInfo product = productService.getById(productId);
            
            if (product != null) {
                // 3. å­˜åœ¨åˆ™ç¼“å­˜æ­£å¸¸æ•°æ®
                redisTemplate.opsForValue().set(cacheKey, JSON.toJSONString(product), 
                    3600, TimeUnit.SECONDS);
            } else {
                // 4. ä¸å­˜åœ¨åˆ™ç¼“å­˜ç©ºå€¼ï¼Œé˜²æ­¢ç©¿é€
                redisTemplate.opsForValue().set(cacheKey, "NULL", 
                    300, TimeUnit.SECONDS); // ç©ºå€¼ç¼“å­˜æ—¶é—´è¾ƒçŸ­
            }
            
            return product;
        }
        
        /*
         * é˜²æŠ¤ç­–ç•¥ï¼š
         * 1. ç©ºå€¼ç¼“å­˜ï¼šç¼“å­˜ä¸å­˜åœ¨çš„æ•°æ®
         * 2. å¸ƒéš†è¿‡æ»¤å™¨ï¼šé¢„å…ˆè¿‡æ»¤ä¸å­˜åœ¨çš„è¯·æ±‚
         * 3. æ¥å£é™æµï¼šé™åˆ¶å•IPè¯·æ±‚é¢‘ç‡
         * 4. å‚æ•°æ ¡éªŒï¼šéªŒè¯å‚æ•°åˆæ³•æ€§
         */
    }
}
```

## ğŸ¯ é¢è¯•é«˜é¢‘é—®é¢˜ç²¾è®²

### æ ¸å¿ƒé¢è¯•é—®é¢˜è§£æ

#### 1. Redisæœ‰å“ªäº›æ•°æ®ç±»å‹ï¼Ÿåº•å±‚æ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ

**æ ‡å‡†ç­”æ¡ˆ**ï¼š

**äº”å¤§åŸºç¡€æ•°æ®ç±»å‹**ï¼š
1. **String**ï¼šåº•å±‚SDSï¼ˆSimple Dynamic Stringï¼‰
2. **Hash**ï¼šziplistï¼ˆå°æ•°æ®ï¼‰æˆ– hashtableï¼ˆå¤§æ•°æ®ï¼‰
3. **List**ï¼šquicklistï¼ˆziplist + linkedlistçš„ç»“åˆï¼‰
4. **Set**ï¼šintsetï¼ˆçº¯æ•´æ•°ï¼‰æˆ– hashtableï¼ˆæ··åˆç±»å‹ï¼‰
5. **ZSet**ï¼šziplistï¼ˆå°æ•°æ®ï¼‰æˆ– skiplist + hashtableï¼ˆå¤§æ•°æ®ï¼‰

**ç¼–ç è½¬æ¢æ¡ä»¶**ï¼š
```redis
# Hashç±»å‹
hash-max-ziplist-entries 512    # é”®å€¼å¯¹æ•°é‡é˜ˆå€¼
hash-max-ziplist-value 64       # å•ä¸ªå€¼å¤§å°é˜ˆå€¼

# ZSetç±»å‹  
zset-max-ziplist-entries 128    # å…ƒç´ æ•°é‡é˜ˆå€¼
zset-max-ziplist-value 64       # å•ä¸ªå€¼å¤§å°é˜ˆå€¼

# Setç±»å‹
set-max-intset-entries 512      # intsetå…ƒç´ æ•°é‡é˜ˆå€¼
```

#### 2. ä»€ä¹ˆæ˜¯SDSï¼Ÿç›¸æ¯”Cå­—ç¬¦ä¸²æœ‰ä»€ä¹ˆä¼˜åŠ¿ï¼Ÿ

**æ ‡å‡†ç­”æ¡ˆ**ï¼š

**SDSï¼ˆSimple Dynamic Stringï¼‰ç‰¹ç‚¹**ï¼š
1. **O(1)è·å–é•¿åº¦**ï¼šlenå­—æ®µè®°å½•å½“å‰é•¿åº¦
2. **é˜²æ­¢ç¼“å†²åŒºæº¢å‡º**ï¼šAPIæ£€æŸ¥ç©ºé—´æ˜¯å¦è¶³å¤Ÿ
3. **å‡å°‘å†…å­˜é‡åˆ†é…**ï¼šç©ºé—´é¢„åˆ†é…å’Œæƒ°æ€§ç©ºé—´é‡Šæ”¾
4. **äºŒè¿›åˆ¶å®‰å…¨**ï¼šå¯ä»¥å­˜å‚¨ä»»æ„äºŒè¿›åˆ¶æ•°æ®

**å†…å­˜åˆ†é…ç­–ç•¥**ï¼š
```c
// ç©ºé—´é¢„åˆ†é…
if (len < 1MB) {
    newlen = len * 2 + 1;
} else {
    newlen = len + 1MB + 1;
}

// æƒ°æ€§ç©ºé—´é‡Šæ”¾
// ç¼©çŸ­å­—ç¬¦ä¸²æ—¶ä¸ç«‹å³é‡Šæ”¾å†…å­˜ï¼Œä¿ç•™ç»™ä¸‹æ¬¡ä½¿ç”¨
```

#### 3. è·³è·ƒè¡¨çš„åŸç†æ˜¯ä»€ä¹ˆï¼Ÿä¸ºä»€ä¹ˆRedisé€‰æ‹©è·³è·ƒè¡¨è€Œä¸æ˜¯çº¢é»‘æ ‘ï¼Ÿ

**æ ‡å‡†ç­”æ¡ˆ**ï¼š

**è·³è·ƒè¡¨åŸç†**ï¼š
- å¤šå±‚æœ‰åºé“¾è¡¨ç»“æ„
- æ¯å±‚éƒ½æ˜¯æœ‰åºçš„
- ä¸Šå±‚æ˜¯ä¸‹å±‚çš„å­é›†
- å¹³å‡æŸ¥æ‰¾å¤æ‚åº¦O(logN)

**Redisé€‰æ‹©è·³è·ƒè¡¨çš„åŸå› **ï¼š
1. **å®ç°ç®€å•**ï¼šç›¸æ¯”çº¢é»‘æ ‘ï¼Œè·³è·ƒè¡¨å®ç°æ›´ç®€å•
2. **èŒƒå›´æŸ¥è¯¢å‹å¥½**ï¼šæ”¯æŒé«˜æ•ˆçš„èŒƒå›´æŸ¥è¯¢æ“ä½œ
3. **å†…å­˜å±€éƒ¨æ€§å¥½**ï¼šé¡ºåºè®¿é—®æ€§èƒ½æ›´å¥½
4. **æ— éœ€æ—‹è½¬æ“ä½œ**ï¼šæ’å…¥åˆ é™¤æ“ä½œæ›´ç®€å•

**åº”ç”¨åœºæ™¯**ï¼š
```redis
# ZSetçš„èŒƒå›´æŸ¥è¯¢
ZRANGE leaderboard 0 9          # è·å–å‰10å
ZRANGEBYSCORE leaderboard 1000 2000  # è·å–åˆ†æ•°åœ¨1000-2000çš„ç”¨æˆ·
```

#### 4. Rediså†…å­˜ä¼˜åŒ–æœ‰å“ªäº›ç­–ç•¥ï¼Ÿ

**æ ‡å‡†ç­”æ¡ˆ**ï¼š

**æ•°æ®ç»“æ„ä¼˜åŒ–**ï¼š
1. **é€‰æ‹©åˆé€‚çš„æ•°æ®ç±»å‹**ï¼šHash vs String
2. **è°ƒæ•´ç¼–ç å‚æ•°**ï¼šä¼˜åŒ–ziplistä½¿ç”¨æ¡ä»¶
3. **ä½¿ç”¨å‹ç¼©**ï¼šå¼€å¯quicklistå‹ç¼©

**Keyè®¾è®¡ä¼˜åŒ–**ï¼š
1. **é¿å…é•¿Key**ï¼šä½¿ç”¨ç®€çŸ­æœ‰æ„ä¹‰çš„Key
2. **ä½¿ç”¨Hashæ ‡ç­¾**ï¼šç›¸å…³æ•°æ®ä½¿ç”¨ç›¸åŒå‰ç¼€
3. **è®¾ç½®è¿‡æœŸæ—¶é—´**ï¼šåŠæ—¶æ¸…ç†æ— ç”¨æ•°æ®

**å†…å­˜å›æ”¶ç­–ç•¥**ï¼š
```redis
# å†…å­˜å›æ”¶ç­–ç•¥é…ç½®
maxmemory-policy allkeys-lru     # LRUæ·˜æ±°ç­–ç•¥
maxmemory 2gb                    # æœ€å¤§å†…å­˜é™åˆ¶

# è¿‡æœŸç­–ç•¥
expire key 3600                  # è®¾ç½®è¿‡æœŸæ—¶é—´
```

## âš¡ æ€§èƒ½ä¼˜åŒ–ä¸æ³¨æ„äº‹é¡¹

### Rediså†…å­˜ç®¡ç†

**å†…å­˜ä½¿ç”¨ç›‘æ§ä¸ä¼˜åŒ–**ï¼š

```java
/**
 * Rediså†…å­˜ç›‘æ§ä¸ä¼˜åŒ–
 */
public class RedisMemoryManagement {
    
    /**
     * å†…å­˜ä½¿ç”¨åˆ†æ
     */
    public void analyzeMemoryUsage() {
        /*
         * å†…å­˜ä¿¡æ¯æŸ¥çœ‹å‘½ä»¤ï¼š
         * 
         * INFO memory
         * å…³é”®æŒ‡æ ‡ï¼š
         * - used_memory: å·²ä½¿ç”¨å†…å­˜
         * - used_memory_rss: ç³»ç»Ÿåˆ†é…çš„ç‰©ç†å†…å­˜
         * - used_memory_peak: å†å²æœ€å¤§å†…å­˜ä½¿ç”¨
         * - mem_fragmentation_ratio: å†…å­˜ç¢ç‰‡ç‡
         * 
         * å†…å­˜ç¢ç‰‡ç‡åˆ†æï¼š
         * - å¤§äº1.5: å†…å­˜ç¢ç‰‡è¾ƒå¤šï¼Œè€ƒè™‘é‡å¯
         * - å°äº1: å¯èƒ½å‘ç”Ÿå†…å­˜äº¤æ¢ï¼Œå½±å“æ€§èƒ½
         * 
         * MEMORY USAGE key
         * æŸ¥çœ‹å•ä¸ªKeyçš„å†…å­˜ä½¿ç”¨æƒ…å†µ
         * 
         * MEMORY DOCTOR
         * è·å–å†…å­˜ä½¿ç”¨å»ºè®®
         */
    }
    
    /**
     * è¿‡æœŸç­–ç•¥é…ç½®
     */
    public void configureExpirationPolicy() {
        /*
         * Redisè¿‡æœŸåˆ é™¤ç­–ç•¥ï¼š
         * 
         * 1. æƒ°æ€§åˆ é™¤ï¼ˆLazy Expirationï¼‰
         *    - è®¿é—®Keyæ—¶æ£€æŸ¥æ˜¯å¦è¿‡æœŸ
         *    - è¿‡æœŸåˆ™åˆ é™¤å¹¶è¿”å›nil
         *    - CPUå‹å¥½ä½†å¯èƒ½å ç”¨å†…å­˜
         * 
         * 2. å®šæœŸåˆ é™¤ï¼ˆActive Expirationï¼‰
         *    - æ¯ç§’è¿è¡Œ10æ¬¡è¿‡æœŸæ£€æŸ¥
         *    - éšæœºæŠ½å–20ä¸ªè®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„Key
         *    - åˆ é™¤å…¶ä¸­è¿‡æœŸçš„Key
         *    - å¦‚æœè¿‡æœŸKeyè¶…è¿‡25%ï¼Œç»§ç»­æŠ½å–
         * 
         * é…ç½®å‚æ•°ï¼š
         * hz 10  # å®šæœŸåˆ é™¤é¢‘ç‡ï¼Œé»˜è®¤10Hz
         * 
         * è¿‡æœŸæ—¶é—´è®¾ç½®å»ºè®®ï¼š
         * - çƒ­ç‚¹æ•°æ®ï¼šè¾ƒé•¿è¿‡æœŸæ—¶é—´ï¼ˆ1-24å°æ—¶ï¼‰
         * - ä¸´æ—¶æ•°æ®ï¼šè¾ƒçŸ­è¿‡æœŸæ—¶é—´ï¼ˆ5-30åˆ†é’Ÿï¼‰
         * - ä¼šè¯æ•°æ®ï¼šæ ¹æ®ä¸šåŠ¡éœ€æ±‚ï¼ˆ30åˆ†é’Ÿ-2å°æ—¶ï¼‰
         */
    }
    
    /**
     * å†…å­˜æ·˜æ±°ç­–ç•¥
     */
    public void configureEvictionPolicy() {
        /*
         * Rediså†…å­˜æ·˜æ±°ç­–ç•¥ï¼š
         * 
         * 1. noevictionï¼ˆé»˜è®¤ï¼‰
         *    - ä¸åˆ é™¤ä»»ä½•Key
         *    - å†…å­˜æ»¡æ—¶è¿”å›é”™è¯¯
         * 
         * 2. allkeys-lru
         *    - ä»æ‰€æœ‰Keyä¸­åˆ é™¤æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„
         *    - é€‚åˆå¤§éƒ¨åˆ†åœºæ™¯
         * 
         * 3. volatile-lru
         *    - ä»è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„Keyä¸­åˆ é™¤LRU
         *    - é€‚åˆæœ‰æ˜ç¡®è¿‡æœŸç­–ç•¥çš„åœºæ™¯
         * 
         * 4. allkeys-lfu (Redis 4.0+)
         *    - ä»æ‰€æœ‰Keyä¸­åˆ é™¤æœ€å°‘ä½¿ç”¨é¢‘ç‡çš„
         *    - é€‚åˆè®¿é—®æ¨¡å¼ç¨³å®šçš„åœºæ™¯
         * 
         * 5. volatile-lfu
         *    - ä»è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„Keyä¸­åˆ é™¤LFU
         * 
         * 6. allkeys-random / volatile-random
         *    - éšæœºåˆ é™¤Key
         * 
         * 7. volatile-ttl
         *    - åˆ é™¤å³å°†è¿‡æœŸçš„Key
         * 
         * é…ç½®å»ºè®®ï¼š
         * maxmemory 2gb
         * maxmemory-policy allkeys-lru
         */
    }
}
```

### æ€§èƒ½è°ƒä¼˜æœ€ä½³å®è·µ

```java
/**
 * Redisæ€§èƒ½è°ƒä¼˜å®è·µ
 */
public class RedisPerformanceTuning {
    
    /**
     * æ‰¹é‡æ“ä½œä¼˜åŒ–
     */
    public void optimizeBatchOperations() {
        /*
         * é—®é¢˜ï¼šé¢‘ç¹çš„ç½‘ç»œå¾€è¿”å½±å“æ€§èƒ½
         */
        
        // âŒ ä½æ•ˆï¼šå¤šæ¬¡ç½‘ç»œè¯·æ±‚
        for (String key : keys) {
            redisTemplate.opsForValue().get(key);
        }
        
        // âœ… ä¼˜åŒ–ï¼šæ‰¹é‡è·å–
        List<String> values = redisTemplate.opsForValue().multiGet(keys);
        
        // âœ… ç®¡é“æ“ä½œ
        List<Object> results = redisTemplate.executePipelined(new RedisCallback<Object>() {
            @Override
            public Object doInRedis(RedisConnection connection) throws DataAccessException {
                for (String key : keys) {
                    connection.get(key.getBytes());
                }
                return null;
            }
        });
        
        /*
         * æ€§èƒ½å¯¹æ¯”ï¼š
         * - å•æ¬¡æ“ä½œï¼š1000æ¬¡è¯·æ±‚éœ€è¦1000æ¬¡ç½‘ç»œå¾€è¿”
         * - æ‰¹é‡æ“ä½œï¼š1000æ¬¡è¯·æ±‚åªéœ€è¦1æ¬¡ç½‘ç»œå¾€è¿”
         * - æ€§èƒ½æå‡ï¼š10-100å€
         */
    }
    
    /**
     * è¿æ¥æ± é…ç½®ä¼˜åŒ–
     */
    public void optimizeConnectionPool() {
        /*
         * Jedisè¿æ¥æ± é…ç½®ï¼š
         */
        JedisPoolConfig config = new JedisPoolConfig();
        
        // è¿æ¥æ± å¤§å°é…ç½®
        config.setMaxTotal(200);        // æœ€å¤§è¿æ¥æ•°
        config.setMaxIdle(50);          // æœ€å¤§ç©ºé—²è¿æ¥æ•°
        config.setMinIdle(10);          // æœ€å°ç©ºé—²è¿æ¥æ•°
        
        // è¿æ¥éªŒè¯é…ç½®
        config.setTestOnBorrow(true);   // è·å–è¿æ¥æ—¶éªŒè¯
        config.setTestOnReturn(false);  // å½’è¿˜è¿æ¥æ—¶éªŒè¯
        config.setTestWhileIdle(true);  // ç©ºé—²æ—¶éªŒè¯è¿æ¥
        
        // è¶…æ—¶é…ç½®
        config.setMaxWaitMillis(3000);  // è·å–è¿æ¥æœ€å¤§ç­‰å¾…æ—¶é—´
        
        /*
         * é…ç½®å»ºè®®ï¼š
         * 1. æ ¹æ®å¹¶å‘é‡è°ƒæ•´è¿æ¥æ± å¤§å°
         * 2. å¼€å¯è¿æ¥éªŒè¯é˜²æ­¢è¿æ¥å¤±æ•ˆ
         * 3. è®¾ç½®åˆç†çš„è¶…æ—¶æ—¶é—´
         * 4. ç›‘æ§è¿æ¥æ± ä½¿ç”¨æƒ…å†µ
         */
    }
    
    /**
     * å¤§Keyé—®é¢˜å¤„ç†
     */
    public void handleBigKeyIssues() {
        /*
         * å¤§Keyé—®é¢˜ï¼š
         * - å†…å­˜å ç”¨è¿‡å¤š
         * - ç½‘ç»œä¼ è¾“è€—æ—¶
         * - é˜»å¡å…¶ä»–æ“ä½œ
         * 
         * è¯†åˆ«å¤§Keyï¼š
         * redis-cli --bigkeys
         * 
         * å¤„ç†ç­–ç•¥ï¼š
         */
        
        // 1. æ‹†åˆ†å¤§Key
        // åŸå§‹ï¼šå­˜å‚¨ç”¨æˆ·æ‰€æœ‰è®¢å•
        // List orders = getUserAllOrders(userId);
        // redisTemplate.opsForValue().set("user:orders:" + userId, orders);
        
        // ä¼˜åŒ–ï¼šæŒ‰æ—¶é—´åˆ†ç‰‡å­˜å‚¨
        String monthKey = "user:orders:" + userId + ":" + yearMonth;
        redisTemplate.opsForList().rightPushAll(monthKey, monthOrders);
        
        // 2. ä½¿ç”¨Hashåˆ†ç‰‡
        // åŸå§‹ï¼šå¤§Hashå­˜å‚¨
        // redisTemplate.opsForHash().putAll("big_hash", largeMap);
        
        // ä¼˜åŒ–ï¼šåˆ†ç‰‡å­˜å‚¨
        int shardCount = 16;
        String shardKey = "hash_shard:" + (key.hashCode() % shardCount);
        redisTemplate.opsForHash().put(shardKey, field, value);
        
        /*
         * å¤§Keyé¢„é˜²ï¼š
         * 1. é™åˆ¶å•ä¸ªKeyçš„å¤§å°ï¼ˆå»ºè®®<10MBï¼‰
         * 2. ä½¿ç”¨Hashåˆ†ç‰‡æŠ€æœ¯
         * 3. å®šæœŸæ¸…ç†æ— ç”¨æ•°æ®
         * 4. ç›‘æ§Keyå¤§å°å˜åŒ–
         */
    }
}
```

## ğŸ“š æ€»ç»“ä¸æŠ€æœ¯å¯¹æ¯”

### æ ¸å¿ƒè¦ç‚¹å›é¡¾

1. **Redisäº”å¤§æ•°æ®ç±»å‹**å„æœ‰é€‚ç”¨åœºæ™¯ï¼Œåº•å±‚å®ç°é’ˆå¯¹ä¸åŒæ•°æ®é‡è¿›è¡Œäº†ä¼˜åŒ–
2. **SDSã€è·³è·ƒè¡¨ã€å‹ç¼©åˆ—è¡¨**ç­‰æ•°æ®ç»“æ„æ˜¯Redisé«˜æ€§èƒ½çš„åŸºç¡€
3. **å†…å­˜ç¼–ç ä¼˜åŒ–**é€šè¿‡è‡ªåŠ¨è½¬æ¢ç¼–ç æ–¹å¼ï¼Œå¹³è¡¡å†…å­˜ä½¿ç”¨å’Œæ€§èƒ½
4. **å†…å­˜ç®¡ç†ç­–ç•¥**åŒ…æ‹¬è¿‡æœŸåˆ é™¤å’Œå†…å­˜æ·˜æ±°ï¼Œä¿è¯ç³»ç»Ÿç¨³å®šè¿è¡Œ
5. **æ€§èƒ½ä¼˜åŒ–**éœ€è¦ä»æ•°æ®ç»“æ„é€‰æ‹©ã€æ‰¹é‡æ“ä½œã€è¿æ¥æ± é…ç½®ç­‰å¤šæ–¹é¢è€ƒè™‘

### Redis vs å…¶ä»–ç¼“å­˜å¯¹æ¯”

| ç‰¹æ€§ | Redis | Memcached | Ehcache |
|------|-------|-----------|---------|
| æ•°æ®ç±»å‹ | ä¸°å¯Œ | ç®€å• | ä¸­ç­‰ |
| æŒä¹…åŒ– | æ”¯æŒ | ä¸æ”¯æŒ | æ”¯æŒ |
| åˆ†å¸ƒå¼ | åŸç”Ÿæ”¯æŒ | éœ€è¦å®¢æˆ·ç«¯ | æ”¯æŒ |
| å†…å­˜æ•ˆç‡ | é«˜ | é«˜ | ä¸­ç­‰ |
| åŠŸèƒ½ä¸°å¯Œåº¦ | éå¸¸é«˜ | ä½ | ä¸­ç­‰ |

### æŒç»­å­¦ä¹ å»ºè®®

1. **æ·±å…¥æºç ç ”ç©¶**ï¼šé˜…è¯»Redisæºç ï¼Œç†è§£åº•å±‚å®ç°ç»†èŠ‚
2. **å®è·µæ€§èƒ½è°ƒä¼˜**ï¼šåœ¨ç”Ÿäº§ç¯å¢ƒä¸­ç§¯ç´¯Redisä¼˜åŒ–ç»éªŒ
3. **å…³æ³¨æ–°ç‰¹æ€§**ï¼šè·Ÿè¸ªRedisæ–°ç‰ˆæœ¬çš„åŠŸèƒ½å’Œä¼˜åŒ–
4. **æŒæ¡ç›‘æ§æŠ€èƒ½**ï¼šç†Ÿç»ƒä½¿ç”¨Redisç›‘æ§å’Œåˆ†æå·¥å…·

---

**ä¸‹ä¸€ç¯‡é¢„å‘Š**ï¼šã€ŠRedisæŒä¹…åŒ–æœºåˆ¶RDBä¸AOFæ·±åº¦è§£æã€‹å°†è¯¦ç»†æ¢è®¨Redisçš„æ•°æ®æŒä¹…åŒ–ç­–ç•¥ã€æ¢å¤æœºåˆ¶å’Œæ€§èƒ½ä¼˜åŒ–ã€‚ 